var type_offset={1:121,3:188,4:258,5:424,11:490,13:584,36:0,23:0,119:0,129:0},lastPage="",lastTime=new Date(-300);function __GetCookie(g){var f=""+document.cookie,j=f.indexOf(g+"=");if(-1==j||""==g){return""}var h=f.indexOf(";",j);-1==h&&(h=f.length);return unescape(f.substring(j+g.length+1,h))}function __SetCookie(f,e){var g=new Date;g.setTime(g.getTime()+31536000000);document.cookie=f+"="+escape(e)+";expires="+g.toGMTString()+"; path=/; domain=.bilibili.com"}function ChatGetSettings(b){return"undefined"!=typeof localStorage?localStorage.getItem(b):__GetCookie(b)}function ChatSaveSettings(e,c){return"undefined"!=typeof localStorage?localStorage.setItem(e,c):__SetCookie(e,c)}Array.prototype.indexOf||(Array.prototype.indexOf=function(f,e){var g=this.length>>>0;e=Number(e)||0;e=0>e?Math.ceil(e):Math.floor(e);for(0>e&&(e+=g);e<g;e++){if(e in this&&this[e]===f){return e}}return -1});var browser={version:function(){var b=navigator.userAgent;return{trident:/Trident/i.test(b),presto:/Presto/i.test(b),webKit:/AppleWebKit/i.test(b),gecko:/Gecko/i.test(b)&&!/KHTML/i.test(b),mobile:/AppleWebKit.*Mobile.*/i.test(b),ios:/\(i[^;]+;( U;)? CPU.+Mac OS X/i.test(b),android:/Android/i.test(b)||/Linux/i.test(b),windowsphone:/Windows Phone/i.test(b),iPhone:/iPhone/i.test(b),iPad:/iPad/i.test(b),MicroMessenger:/MicroMessenger/i.test(b),webApp:!/Safari/i.test(b)}}(),language:(navigator.browserLanguage||navigator.language).toLowerCase()},lastMessageBoxLayer=10000;function MessageBox(e){this.params={evType:"over",Overlap:!1,focusShowPos:"down",zIndex:10000,animation:"slide",position:null,event:null};"string"==typeof e&&(e={evType:e});if("object"==typeof e){for(var c in this.params){e.hasOwnProperty(c)&&(this.params[c]=e[c])}}}MessageBox.prototype={timer:null,msgbox:null,bindobj:null,incomingTimer:null,position:{},show:function(l,j,s,r,q){if(!1!=this.params.Overlap||"yes"!=$(l).attr("hasMessageBox")){$(l).attr("hasMessageBox","yes");"undefined"==typeof s&&(s=1000);"undefined"==typeof r&&(r="msg");"button"==s&&(q=r,r=s,s=1000);var p=s;0==s&&(p=50);var o=r;"button"==r&&(o="question");var n=this;n.leftTimer=function(){"button"!=r&&(clearTimeout(n.timer),n.timer=setTimeout(function(){clearTimeout(n.timer);n.close(n)},p))};n.incomingTimer=function(){clearTimeout(n.timer)};this.bindobj=l;this.msgbox=$('<div class="m_layer"><div class="bg"><div class="content"><div class="mini"><b class="'+o+'"></b>'+j+("button"==r?'<div class="btnbox"><a class="b-btn ok">\u786e\u8ba4</a><a class="b-btn-cancel cancel">\u53d6\u6d88</a></div>':"")+"</div></div></div></div>").prependTo("body");this.msgbox.css("z-index",n.zIndex);"over"==this.params.evType?($(l).bind("mouseleave",n.leftTimer),$(l).bind("mouseenter",n.incomingTimer),this.msgbox.bind("mouseenter",function(){clearTimeout(n.timer)}),this.msgbox.bind("mouseleave",n.leftTimer)):$(l).bind("blur",n.leftTimer);this.setPos(this.params.focusShowPos);this.params.position&&(this.position=this.params.position,this.resetBound());this.msgbox.css("left",n.position.left+"px");this.msgbox.css("top",n.position.top+"px");this.msgbox.css("z-index",lastMessageBoxLayer++);this.msgbox.hide();"button"==r&&(this.msgbox.find(".ok").click(function(){"undefined"!=typeof q&&!1==q(n)||n.close()}),this.msgbox.find(".cancel").click(function(){n.close()}));0!=s&&n.leftTimer();"fade"!=this.params.animation?this.msgbox.slideDown(200):this.moveIn(this.params.focusShowPos);return this.msgbox}},close:function(){var b=this;$(b.bindobj).attr("hasMessageBox","");"fade"!=this.params.animation?this.msgbox.slideUp(200):this.msgbox.fadeOut(200);setTimeout(function(){b.msgbox.remove();"over"==b.params.evType&&$(b.bindobj).off("mouseenter",b.incomingTimer);$(b.bindobj).off("over"==b.params.evType?"mouseleave":"blur",b.leftTimer)},200)},moveIn:function(g){var f={opacity:1},j=5,h=5;switch(g){case"up":f.top="-=5";h=0;break;case"down":f.top="+=5";j=-j;h=0;break;case"left":f.left="-=5";j=0;break;case"right":f.left="+=5";h=-h;j=0;break;default:f.top="-=5",h=0}this.msgbox.show().css({top:this.position.top+j,left:this.position.left+h,opacity:0});this.msgbox.animate(f,200)},setPos:function(e){var c=$(this.bindobj);this.params.focusShowPos=e;switch(e){case"up":this.position.top=c.offset().top-this.msgbox.outerHeight();this.position.left=c.offset().left;if(!this.checkBound("up")){return this.setPos("down")}break;case"down":this.position.top=c.offset().top+c.outerHeight();this.position.left=c.offset().left;if(!this.checkBound("down")){return this.setPos("up")}break;case"left":this.position.top=c.offset().top;this.position.left=c.offset().left-this.msgbox.outerWidth();if(!this.checkBound("left")){return this.setPos("right")}break;case"right":if(this.position.top=c.offset().top,this.position.left=c.offset().left+c.outerWidth(),!this.checkBound("right")){return this.setPos("left")}}this.resetBound();return this.position},resetBound:function(){for(var f=["up","down","left","right"],e=0;e<f.length;e++){var g=f[e];this.checkBound(g)||this.setBound(g)}},checkBound:function(b){switch(b){case"up":return this.position.top>=$(window).scrollTop();case"down":return this.position.top+this.msgbox.outerHeight()<=$(window).height()+$(window).scrollTop();case"left":return this.position.left>=$(window).scrollLeft();case"right":return this.position.left+this.msgbox.outerWidth()<=$(window).width()+$(window).scrollLeft();default:return !0}},setBound:function(b){switch(b){case"up":this.position.top=$(window).scrollTop();break;case"down":this.position.top=$(window).height()+$(window).scrollTop()-this.msgbox.outerHeight();break;case"left":this.position.left=$(window).scrollLeft();break;case"right":this.position.left=$(window).width()+$(window).scrollLeft()-this.msgbox.outerWidth()}}};function htmlspecialchars(b){return b.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#039;")}function pagelist(u,t,s,r,q,p,o){o=o?o:3;t=parseInt(t);s=parseInt(s);r=parseInt(r);if(1>=s&&0<r||0==r){return !1}var l,j=2*o+1;t>=j?(l=t-o,j=t+o):l=1;j>s&&(j=s);null!=p?$('<span class="result">\u5171 '+s+" \u9875/ "+r+" \u4e2a"+p+" </span>").appendTo(u):$('<span class="result">\u5171 '+s+" \u9875 </span>").appendTo(u);1!=t&&($('<a class="b-btn indexPage" href="javascript:;" page="1">\u9996\u9875 </a>').appendTo(u).click(function(){q($(this).attr("page"))}),$('<a class="b-btn prevPage" href="javascript:;" page="'+(t-1)+'">\u4e0a\u9875 </a>').appendTo(u).click(function(){q($(this).attr("page"))}));for(;l<=j;l++){l==t?$("<strong>"+l+"</strong>").appendTo(u):$('<a class="p" href="javascript:;" page="'+l+'">'+l+"</a>").appendTo(u).click(function(){q($(this).attr("page"))})}t!=s&&1<s&&$('<a class="b-btn nextPage" href="javascript:;" page="'+(t+1)+'">\u4e0b\u9875</a>').appendTo(u).click(function(){q($(this).attr("page"))});t!=s&&1<s&&$('<a class="b-btn endPage" href="javascript:;" page="'+s+'">\u672b\u9875</a>').appendTo(u).click(function(){q($(this).attr("page"))})}function pagelist_ul(k,j,q,p,o,n){n=n?n:3;j=parseInt(j);q=parseInt(q);p=parseInt(p);if(1>=q&&0<p||0==p){return !1}var l=2*n+1;j>=l?(p=j-n,l=j+n):p=1;l>q&&(l=q);$(k).empty();for(1!=j&&1!=p?$('<li page="1"><a class="indexPage" href="javascript:;">|&lt;</a></li>').appendTo(k).click(function(){o($(this).attr("page"))}):1!=j&&$('<li page="1"><a class="indexPage" href="javascript:;">|&lt;</a></li>').appendTo(k).click(function(){o($(this).attr("page"))});p<=l;p++){p==j?$('<li class="current">'+p+"</li>").appendTo(k):$('<li page="'+p+'"><a href="javascript:;">'+p+"</a></li>").appendTo(k).click(function(){o($(this).attr("page"))})}j!=q&&1<q&&$('<li page="'+q+'"><a class="endPage" href="javascript:;">&gt;|</a></li>').appendTo(k).click(function(){o($(this).attr("page"))})}var evCardTimer=null;function loadFB(g,f,j){g="/feedback/arc-"+g+"-"+f+".html?r="+Math.random();if(g!=lastPage){lastPage=g;$(".comm > .loading").remove();$('<div class="loading"></div>').prependTo(".comm");var h=new Date;$.ajax(lastPage,{success:function(e){var c=(new Date).getTime()-h.getTime();500>c?setTimeout(function(){$(".comm").html(e);"undefined"!=typeof j&&j();bindCardEvent()},0>=300-c?10:300-c):($(".comm").html(e),"undefined"!=typeof j&&j(),bindCardEvent())}})}}function loadTopicFB(g,f,j){g="/feedback/topic-"+g+"-"+f+".html?r="+Math.random();if(g!=lastPage){lastPage=g;$(".comm > .loading").remove();$('<div class="loading"></div>').prependTo(".comm");var h=new Date;$.ajax(lastPage,{success:function(e){var c=(new Date).getTime()-h.getTime();500>c?setTimeout(function(){$(".comm").html(e);"undefined"!=typeof j&&j();bindCardEvent()},0>=300-c?10:300-c):($(".comm").html(e),"undefined"!=typeof j&&j(),bindCardEvent())}})}}var searchKW="";function searchAT(){searchKW=$("#search_key").val();loadAT(1)}function loadAT(e){e="/account/at/at-"+e+"?search="+searchKW+"&att="+($(".ms-btn.addinfo").hasClass("on")?1:0)+"&r="+Math.random();if(e!=lastPage){lastPage=e;$("#atme.atlist > .loading").remove();$('<div class="loading"></div>').prependTo("#atme.atlist");var c=new Date;$.ajax(lastPage,{success:function(b){var f=(new Date).getTime()-c.getTime();500>f?setTimeout(function(){$("#atme.atlist").html(b);bindCardEvent()},0>=300-f?10:300-f):($("#atme.atlist").html(b),bindCardEvent())}})}}function searchDyn(){searchKW=$("#search_key").val();loadDyn(1)}function loadDyn(e){e="/account/dynamic/dyn-"+e+"?search="+searchKW+"&fb="+($("#track_comment").hasClass("on")?1:0)+"&r="+Math.random();if(e!=lastPage){lastPage=e;$("#dynlist.atlist > .loading").remove();$('<div class="loading"></div>').prependTo("#dynlist.atlist");var c=new Date;$.ajax(lastPage,{success:function(b){var f=(new Date).getTime()-c.getTime();500>f?setTimeout(function(){$("#dynlist.atlist").html(b);bindCardEvent()},0>=300-f?10:300-f):($("#dynlist.atlist").html(b),bindCardEvent())}})}}function agFB(h,g,l,k){var j="";switch(l){case"arc":j="aid="+g;break;case"news":j="news_id="+g;break;case"topic":j="tp_id="+g}$.ajax({type:"get",url:"http://interface.bilibili.com/feedback/agreement?mode="+l+"&"+j+"&rid="+k+"&callback=?",dataType:"jsonp",success:function(a){"OK"!=a?(new MessageBox).show(h,a,2000,"warning"):(a=$(h).children("b").html(),a=a.substr(2),a=a.substr(0,a.length-1),$(h).children("b").html("(+"+(parseInt(a)+1)+")"),(new MessageBox).show(h,"\u8d5e\u540c\u6210\u529f",500,"info"))},error:function(){(new MessageBox).show(h,"\u53d1\u9001\u5931\u8d25\uff0c\u8bf7\u68c0\u67e5\u60a8\u7684\u7f51\u7edc\u6216\u53d1\u9001\u90ae\u4ef6\u81f3 orz#hdslb.com",2000,"error")}});return !1}function dagFB(h,g,l,k){var j="";switch(l){case"arc":j="aid="+g;break;case"news":j="news_id="+g;break;case"topic":j="tp_id="+g}$.ajax({type:"get",url:"http://interface.bilibili.com/feedback/disagreement?mode="+l+"&"+j+"&rid="+k+"&callback=?",dataType:"jsonp",success:function(a){"OK"!=a?(new MessageBox).show(h,a,2000,"warning"):(a=$(h).children("b").html(),a=a.substr(2),a=a.substr(0,a.length-1),$(h).children("b").html("(+"+(parseInt(a)+1)+")"),(new MessageBox).show(h,"\u53cd\u5bf9\u6210\u529f",500,"info"))},error:function(){(new MessageBox).show(h,"\u53d1\u9001\u5931\u8d25\uff0c\u8bf7\u68c0\u67e5\u60a8\u7684\u7f51\u7edc\u6216\u53d1\u9001\u90ae\u4ef6\u81f3 orz#hdslb.com",2000,"error")}});return !1}function adDropFB(j,h,o,n,l){var k="";switch(n){case"arc":k="aid="+o;break;case"news":k="news_id="+o;break;case"topic":k="tp_id="+o}$.ajax({type:"get",url:"http://interface.bilibili.com/m/hideFeedback?"+k+"&drop=1&rid="+l+"&callback=?",dataType:"jsonp",success:function(a){"OK"!=a?(new MessageBox({Overlap:!0,position:h.position})).show(j,a,2000,"warning"):((new MessageBox({Overlap:!0,position:h.position})).show(j,"\u5220\u9664\u6210\u529f",500,"info"),setTimeout(function(){$(j).closest("li").slideUp(500)},500))},error:function(){(new MessageBox({Overlap:!0,position:h.position})).show(j,"\u53d1\u9001\u5931\u8d25\uff0c\u8bf7\u68c0\u67e5\u60a8\u7684\u7f51\u7edc\u6216\u53d1\u9001\u90ae\u4ef6\u81f3 orz#hdslb.com",2000,"error")}});return !1}function adHideFB(h,g,l,k){"undefined"==h&&(h=this);var j="";switch(l){case"arc":j="aid="+g;break;case"news":j="news_id="+g;break;case"topic":j="tp_id="+g}$.ajax({type:"get",url:"http://interface.bilibili.com/m/hideFeedback?"+j+"&rid="+k+"&callback=?",dataType:"jsonp",success:function(a){"OK"!=a?(new MessageBox).show(h,a,2000,"warning"):((new MessageBox).show(h,"\u9690\u85cf\u6210\u529f",500,"info"),$(h).parent().find(".showfb").show(),$(h).hide())},error:function(){(new MessageBox).show(h,"\u53d1\u9001\u5931\u8d25\uff0c\u8bf7\u68c0\u67e5\u60a8\u7684\u7f51\u7edc\u6216\u53d1\u9001\u90ae\u4ef6\u81f3 orz#hdslb.com",2000,"error")}});return !1}function adShowFB(h,g,l,k){"undefined"==h&&(h=this);var j="";switch(l){case"arc":j="aid="+g;break;case"news":j="news_id="+g;break;case"topic":j="tp_id="+g}$.ajax({type:"get",url:"http://interface.bilibili.com/m/showFeedback?"+j+"&rid="+k+"&callback=?",dataType:"jsonp",success:function(a){"OK"!=a?(new MessageBox).show(h,a,2000,"warning"):((new MessageBox).show(h,"\u663e\u793a\u6210\u529f",500,"info"),$(h).parent().find(".hidefb").show(),$(h).hide())},error:function(){(new MessageBox).show(h,"\u53d1\u9001\u5931\u8d25\uff0c\u8bf7\u68c0\u67e5\u60a8\u7684\u7f51\u7edc\u6216\u53d1\u9001\u90ae\u4ef6\u81f3 orz#hdslb.com",2000,"error")}});return !1}function insertAtCursor(h,g){if(document.selection){h.focus(),sel=document.selection.createRange(),sel.text=g,sel.select()}else{if(h.selectionStart||"0"==h.selectionStart){var l=h.selectionStart,k=h.selectionEnd,j=h.scrollTop;h.value=h.value.substring(0,l)+g+h.value.substring(k,h.value.length);0<j&&(h.scrollTop=j);h.focus();h.selectionStart=l+g.length;h.selectionEnd=l+g.length}else{h.value+=g,h.focus()}}}function reportFB(e,c){(new MessageBox).show(e,'<h3>\u8bf7\u8f93\u5165\u4e3e\u62a5\u7406\u7531</h3><form action="http://interface.bilibili.com/m/report_feedback?fbid='+c+'" method="post" target="_blank" id="reportfb_form"><textarea name="message"></textarea></form>',"button",function(){$("#reportfb_form").submit()});return !1}function set_qure(b){$("._qure .t").html($("#l_id_"+b+" .t").html());$("._qure").show()}function replyFB(b){$("#quoteID").val(b);$("#comment_reply_text").focus()}function commitFeedback(b){if("\u8bf7\u5728\u8fd9\u91cc\u8f93\u5165\u60a8\u8981\u53d1\u8868\u7684\u8bc4\u8bba\u4fe1\u606f"==$("#comment_text",b).val()){return $("#comment_text",b).focus(),!1}if(1000<$("#comment_text",b).val().length||4>$("#comment_text",b).val().length){return alert("\u8bc4\u8bba\u5b57\u6570\u5fc5\u987b\u57284\u52301000\u4e2a\u4e4b\u95f4\uff01"),$("#comment_text",b).focus(),!1}$.post("/feedback/post","msg="+encodeURIComponent($("#comment_text",b).val().replace(/%/g,"%25")).replace(/\+/g,"%2B")+(0<$("#fb_aid").length?"&aid="+$("#fb_aid").val():0<$("#fb_tp_id").length?"&tp_id="+$("#fb_tp_id").val():"&news_id="+$("#fb_news_id").val())+"&action=send&quoteID="+$("#quoteID").val()+(0<$("#fb_vcode").length?"&vcode="+$("#fb_vcode").val():""),function(c){"OK"==c?reloadFeedback():alert(c)})}function human_date(h){var g=Math.floor((new Date).getTime()/1000),l=new Date;l.setHours(0);l.setMinutes(0);l.setSeconds(0);l=Math.floor(l.getTime()/1000);if(h>l&&0<=g-h){return 50>=g-h?(g=10*Math.floor((g-h)%60/10),(10<h?g:10)+"\u79d2\u524d"):3600>g-h?Math.ceil((g-h)/60)+"\u5206\u949f\u524d":Math.ceil((g-h)/3600)+"\u5c0f\u65f6\u524d"}g=new Date;g.setTime(1000*h);h=g.getMonth()+1;var l=g.getDate(),k=g.getHours(),j=g.getMinutes();10>h&&(h="0"+h);10>l&&(l="0"+l);10>k&&(k="0"+k);10>j&&(j="0"+j);return g.getFullYear()+"-"+h+"-"+l+" "+k+":"+j}function bbFeedback(f,e,g){this.type=e?e:"arc";this.target=f;this.$target=$(f).addClass("pc");browser.version.mobile&&!browser.version.iPad?this.$target.removeClass("pc").addClass("mobile"):(browser.version.iPad||browser.version.android)&&this.$target.removeClass("pc");this.allowFeed=g;window.feedback_object=this;this.captcha=window.captcha_key;this.mids=[];this.hasFeedMids=[];this.floorObjs={};$("<style>#dcmp_textarea_container .ui-autocomplete{ margin-top: 5px; margin-left: -10px; max-width: 150px; }</style>").appendTo("head")}bbFeedback.prototype={quoteID:0,isAdmin:-1,orderby:"default",checkLogin:function(b){return window.biliLoginStatus.isLogin?!0:($("#comment_text",b).attr("placeholder","\u8bf7\u5148\u767b\u5f55"),$(".user_face img",b).hide(),$("button[type=submit]",b).click(function(){(new MessageBox).show($(this),"\u8bf7\u5148\u767b\u5f55",1500,"warning")}),!1)},pushUser:function(e,c){"undefined"==typeof this.floorObjs[e]&&(this.floorObjs[e]=[]);this.floorObjs[e].push(c);return 0>this.mids.indexOf(e)&&0>this.hasFeedMids.indexOf(e)?(this.mids.push(e),!0):!1},pushFeedUser:function(b){return 0>this.hasFeedMids.indexOf(b)?(this.hasFeedMids.push(b),!0):!1},checkFeed:function(e){if(!0===this.allowFeed){var c=this;this.captcha||Captcha.set(function(b){c.captcha=b});$.ajax({url:"http://test-prop.bilibili.com/api/electric/has.feed",data:{mids:this.mids.join(),aid:e,captcha:this.captcha},dataType:"json",type:"POST",xhrFields:{withCredentials:!0},success:function(g){if(g.code&&-700==g.code){Captcha.set(function(f){c.captcha=f;c.checkFeed(e)})}else{if(g.data&&g.data.result){for(var b=0;b<g.data.result.length;b++){var a=g.data.result[b];a.feed_status&&c.pushFeedUser(a.mid)}}c.addFeedTag()}},error:function(){}})}},addFeedTag:function(){for(var g=0;g<this.hasFeedMids.length;g++){for(var f=0;f<this.floorObjs[this.hasFeedMids[g]].length;f++){var j=this.floorObjs[this.hasFeedMids[g]][f];if(!(0<j.find(".feedtag").length)){var h=$("<div>").addClass("feedtag");0<j.parents(".reply").length?h.insertAfter(j.find(".name")):j.find(".t").append(h);j=$("#battery_ranking").find('[mid="'+this.hasFeedMids[g]+'"]');0<j.length&&(j=parseInt(j.attr("rank")),3>=j&&h.addClass("n n"+j))}}}},recordToObject:function(h,g){function l(b){return b.replace(/\n/g,"<br />").replace(k,'<a href="javascript:;" card="$1">@$1</a>').replace(j,'<a href="/video/av$1/" target="_blank">av$1</a>')}var k=RegExp(/@([^\s:@~!#$%^&*\(\)<]{2,15})/g),j=RegExp(/av([0-9]+)/g);1==g.ad_check?($('<a href="javascript:;">[\u6b64\u697c\u5c42\u5df2\u88ab\u7528\u6237\u9690\u85cf \u70b9\u51fb\u67e5\u770b]</a>').appendTo(h).click(function(){$(this).next().slideToggle(200)}),$('<div style="display:none" class="quote">'+l(g.msg)+"</div>").appendTo(h)):2==g.ad_check?window.uid==g.mid?h.html(l(g.msg)):$('<a href="javascript:;">[\u6b64\u697c\u5c42\u5df2\u88ab\u7ba1\u7406\u5458\u5220\u9664]</a>').appendTo(h):3==g.ad_check?$('<a href="javascript:;">[\u6b64\u697c\u5c42\u5df2\u88ab\u4e3e\u62a5\u5e76\u88ab\u7ba1\u7406\u5458\u5220\u9664]</a>').appendTo(h):h.html(l(g.msg))},reply_render:function(j,h){var o=$('<li><a class="re_face" href="http://space.bilibili.com/'+j.mid+'" target="_blank" card="'+j.nick+'"><img src="'+j.face+'" /></a>                <div class="re_cnt">                \t<div class="w"><a class="name" href="http://space.bilibili.com/'+j.mid+'" target="_blank" card="'+j.nick+'">'+j.nick+'</a>: <span class="content"></span></div>                    <div class="info">                    \t<p>'+(0<=this.isAdmin&&"arc"==this.type?'      <a class="jubao">\u4e3e\u62a5</a>':"")+"                            <span>"+j.create_at+"</span>"+(0<=this.isAdmin?'        <a class="zan" onclick="javascript:;"><b>(+'+j.good+")</b></a>":"")+(0<=this.isAdmin?'      <a class="re_ta" href="javascript:;;">\u56de\u590dTa</a>':"")+"                        </p>                    </div>                </div>            </li>").appendTo(h),n=this,l=o.find(".content");n.recordToObject(l,j);3<=this.isAdmin&&$('<a href="javascript:;" title="\u88ab\u79fb\u9664\u540e\uff0c\u5176\u4ed6\u7528\u6237\u4f1a\u9ed8\u8ba4\u4e0d\u663e\u793a\u8be5\u8bc4\u8bba" class="no hidefb">\u79fb\u9664\u8be5\u8bc4\u8bba</a>').prependTo(o.find(".info p")).click(function(){var a=this;(new MessageBox).show(this,"\u786e\u8ba4\u5220\u9664\u6b64\u5185\u5bb9?","button",function(b){adDropFB(a,b,n.id,n.type,j.fbid)});return !1});if(1<=n.isAdmin){var l=$('<a href="javascript:;" title="\u88ab\u9690\u85cf\u540e\uff0c\u5176\u4ed6\u7528\u6237\u4f1a\u9ed8\u8ba4\u4e0d\u663e\u793a\u8be5\u8bc4\u8bba" class="no hidefb">'+(2<=n.isAdmin?"\u5220\u9664":"\u9690\u85cf")+"\u8be5\u8bc4\u8bba</a>").prependTo(o.find(".info p")).click(function(){adHideFB(this,n.id,n.type,j.fbid);return !1}),k=$('<a href="javascript:;" class="yes showfb">\u663e\u793a\u8be5\u8bc4\u8bba</a>').prependTo(o.find(".info p")).click(function(){adShowFB(this,n.id,n.type,j.fbid);return !1});0==j.ad_check?k.hide():l.hide()}0<=n.isAdmin&&(o.find(".jubao").click(function(){return reportFB(this,j.fbid)}),o.find(".zan").click(function(){return agFB(this,n.id,n.type,j.fbid)}));n.pushUser(j.mid,o);return o},loadReply:function(h,g,l,k){"undefined"===typeof k&&(k=1);var j=this;$.ajax({dataType:"json",url:"http://api.bilibili.com/feedback?type=jsonp&ver=3&callback=?&mode="+j.type+"&"+j.id_name+"="+this.id+"&replyID="+l+"&pagesize=10&page="+k,success:function(b){$(g).empty();$(h).empty();pagelist(h,k,b.pages,b.results,function(c){j.loadReply(h,g,l,c)},"\u8bc4\u8bba",5);for(var a=0;a<b.list.length;a++){(function(c){j.reply_render(c,g).find(".re_ta").click(function(){j.re_send_show($(this).parents(".reply").find(".re_send"),$(this).parents(".re_cnt").find(".name").html(),c.fbid,function(f){j.loadReply(h,g,l,Math.ceil((b.results+1)/10));$(".re_send",j.target).hide();$(".re_send",j.target).children().remove();return !1})})})(b.list[a])}j.checkFeed(j.id);bindCardEvent(g);$(g).height()>$(window).height()?$(document).scrollTop($(g).offset().top-5):$(document).scrollTop($(g).offset().top-($(window).height()-$(g).height())/2)}})},submitFeedback:function(g,f,j){if("\u8bf7\u5728\u8fd9\u91cc\u8f93\u5165\u60a8\u8981\u53d1\u8868\u7684\u8bc4\u8bba\u4fe1\u606f"==$("#comment_text",f).val()){return $("#comment_text",f).focus(),!1}if(1000<$("#comment_text",f).val().length||4>$("#comment_text",f).val().length){return(new MessageBox).show(g,"\u8bc4\u8bba\u5b57\u6570\u5fc5\u987b\u57284\u52301000\u4e2a\u4e4b\u95f4\uff01",3000,"error"),$("#comment_text",f).focus(),!1}var h=this;$.ajax({url:"http://interface.bilibili.com/feedback/post?callback=?&msg="+encodeURIComponent($("#comment_text",f).val().replace(/%/g,"%25")).replace(/\+/g,"%2B")+("arc"==h.type?"&aid="+h.id:"topic"==h.type?"&tp_id="+h.id:"&news_id="+h.id)+"&action=send&quoteID="+h.quoteID+(0<$("#fb_vcode",f).length?"&vcode="+$("#fb_vcode",f).val():""),type:"get",dataType:"jsonp",success:function(a){"OK"==a?"function"==typeof j&&!1===j(h.id)||h.show(h.id,1):(new MessageBox).show(g,a,3000,"error")},error:function(){(new MessageBox).show(g,"\u53d1\u9001\u5931\u8d25",2000,"error")}})},re_send_show:function(k,j,q,p){var o=this,n=k.parents(".reply");if(0==k.children().length){$(".reply",o.target).each(function(a,c){c=$(c);"block"==c.css("display")&&0==c.find(".re_ul").children().length&&c[0]!=k.parent()[0]?c.hide():c[0]==k.parent()[0]&&c.show()});$(".re_send",o.target).hide();$(".re_send",o.target).children().remove();n=$(".comm_send",o.target).html();k.append(n);$("._qure .t",k).html("");o.checkLogin(k);$("button[type=submit]",k).click(function(){if(window.biliLoginStatus.isLogin){return o.quoteID=q,o.submitFeedback(this,k,p)}});k.find(".ywz").removeClass("open");k.find(".biaoqing_box").removeClass("open");k.show();var l=0;$(".ywz",k).click(function(){0==l?($(this).addClass("open"),$(".biaoqing_box",k).addClass("open"),$(".biaoqing_box",k).show(),$(".biaoqing_box a",k).unbind("click"),$(".biaoqing_box a",k).click(function(){insertAtCursor($(".ipt-txt",k).get(0),$(this).html());l=0}),l=1):($(this).removeClass("open"),$(".biaoqing_box",k).removeClass("open"),$(".biaoqing_box",k).hide(),l=0)});k.find(".ipt-txt").val("");null!=j&&(k.find(".ipt-txt").focus(),insertAtCursor($(".ipt-txt",k).get(0),"\u56de\u590d @"+j+" :"))}else{null!=j?(k.show(),k.find(".ipt-txt").focus(),k.find(".ipt-txt").val(""),insertAtCursor($(".ipt-txt",k).get(0),"\u56de\u590d @"+j+" :")):""==k.find(".ipt-txt").val()||k.parent().hasClass("empty")?(j=0==n.find(".re_ul").children().length?!0:!1,"none"!=k.css("display")?(k.hide(),j&&n.hide()):(k.show(),j&&n.show())):k.find(".ipt-txt").val("")}},show:function(h,g,l){"undefined"===typeof g&&(g=1);var k=this,j="aid";this.id=h;switch(k.type){case"topic":j="tp_id";break;case"news":j="news_id"}k.id_name=j;0==$(".comm_send",k.target).length&&$(document).scroll(function(){var b=$(".comm_send",k.target);$(k.target).height()>$(window).height()&&($(k.target).offset().top+$(k.target).height()<$(window).scrollTop()+$(window).height()&&b.offset().top+b.outerHeight()<$(window).scrollTop()?b.appendTo(k.target).addClass("bottom"):$(k.target).offset().top>$(window).scrollTop()&&b.offset().top>$(window).scrollTop()+$(window).height()&&b.prependTo(k.target).removeClass("bottom"))});$.ajax({dataType:"json",url:"http://api.bilibili.com/feedback?type=jsonp&ver=3&callback=?&mode="+k.type+"&"+j+"="+h+"&pagesize=20&page="+g+("default"!=k.orderby?"&order="+k.orderby:""),success:function(w){var r=k.target;$(".common .b-head .results").html(w.results);if(-503===w.code){var o=$(r).css("position");$(r).css("position","relative");$('<div style="opacity: 0.3;z-index: 1000;background-color: #ccc;width: 100%;height: 100%;display: block;position: absolute;"></div>').prependTo(r);setTimeout(function(){$(r).css("position",o);k.show(h,g)},2000)}else{if("object"==typeof w.list){k.isAdmin=w.isAdmin;$(r).empty();if("topic"!=k.type){var c=$('<div class="c_order"><ul class="b-slt-tab"><li order="default"><a>\u9ed8\u8ba4\u6392\u5e8f</a></li><li order="good"><a>\u6309\u8d5e\u540c\u6570</a></li><li order="hot"><a>\u6309\u56de\u590d\u6570</a></li></ul></div>').appendTo(r);$('li[order="'+k.orderby+'"]',c).addClass("on");$("li",c).click(function(){var f=$(this);f.hasClass("on")||($("li",c).removeClass("on"),f.addClass("on"),k.orderby=f.attr("order"),k.show(h,1))})}var z=$('<ul class="comm_list"></ul>').appendTo(r),b=$('<div class="pagelistbox"></div>').appendTo(r),x=$('<div class="pagelistbox top"></div>').insertBefore(z);pagelist(b,g,w.pages,w.results,function(f){k.show(h,f);$(window).scrollTop($(k.target).offset().top+$(".z_top").outerHeight())},"\u8bc4\u8bba",4);pagelist(x,g,w.pages,w.results,function(f){k.show(h,f)},null,2);0==w.results&&$('<div class="no_more">\u6ca1\u6709\u66f4\u591a\u4fe1\u606f</div>').appendTo(r);for(var y in w.list){"object"==typeof w.list[y]&&function(E){var D=$('<li id="l_id_'+E.fbid+'"><a href="http://space.bilibili.com/'+E.mid+'" target="_blank" card="'+E.nick+'"><div class="facebox r'+E.rank+'"><img src="'+E.face+'" class="face"><div class="face_bg"></div></div></a><div class="t"><span class="lnum">#'+E.lv+'</span><a href="http://space.bilibili.com/'+E.mid+'" target="_blank" card="'+E.nick+'">'+E.nick+'</a></div><div class="content"></div><div class="elinfo">'+human_date(E.create)+("Web"!=E.device?'<a class="ico '+E.device+'">'+("WP"==E.device?"Windows Phone":E.device)+"</a>":"")+'<i class="report"></i></div></li>').appendTo(z);k.pushUser(E.mid,D);var C=D.find(".content");k.recordToObject(C,E);null!=E.quote&&(C=$('<div class="quote"><div class="t">#'+E.quote.lv+'<a href="http://space.bilibili.com/'+E.quote.mid+'" target="_blank" card="'+E.quote.nick+'">'+E.quote.nick+'</a></div><div class="content"></div></div>').prependTo(C).find(".content"),k.recordToObject(C,E.quote));if(null!=E.reply){var B=$('<div class="reply"><ul class="re_ul"></ul><div class="re_box">\t<p class="j_re"><a class="re_send_s" href="javascript:;">\u53c2\u4e0e\u56de\u590d</a></p>'+(5<E.reply_count?'<p class="re_more"><span>\u8fd8\u6709<b> '+(E.reply_count-5)+' </b>\u6761\u56de\u590d </span><a class="re_more_s">\u70b9\u51fb\u67e5\u770b</a></p>':"")+'<div class="re_page">\t<div class="pagelistbox">\t</div></div></div><div class="re_send"></div></div>').appendTo(D);$(".re_send_s",B).click(function(){k.re_send_show($(this).parents(".reply").find(".re_send"),null,E.fbid,function(f){$(".re_more",B).remove();k.loadReply($(".pagelistbox",B),v,E.fbid,Math.ceil((E.reply_count+1)/10));$(".re_send",k.target).hide();$(".re_send",k.target).children().remove();return !1})});var v=$(".re_ul",B);$(".re_more_s",B).click(function(){$(".re_more",B).remove();k.loadReply($(".pagelistbox",B),v,E.fbid,1)});for(C=0;C<E.reply.length;C++){(function(n,f){k.reply_render(n,v).find(".re_ta").click(function(){k.re_send_show($(this).parents(".reply").find(".re_send"),$(this).parents(".re_cnt").find(".name").html(),n.fbid,function(p){$(".re_more",B).remove();k.loadReply($(".pagelistbox",B),v,f.fbid,Math.ceil((f.reply_count+1)/10));$(".re_send",k.target).hide();$(".re_send",k.target).children().remove();return !1})})})(E.reply[C],E)}}C=D.find(".report");3<=k.isAdmin&&$('<a href="javascript:;" title="\u88ab\u79fb\u9664\u540e\uff0c\u5176\u4ed6\u7528\u6237\u4f1a\u9ed8\u8ba4\u4e0d\u663e\u793a\u8be5\u8bc4\u8bba" class="no hidefb">\u79fb\u9664\u8be5\u8bc4\u8bba</a>').prependTo(C).click(function(){var f=this;(new MessageBox).show(this,"\u786e\u8ba4\u5220\u9664\u6b64\u5185\u5bb9?","button",function(n){adDropFB(f,n,h,k.type,E.fbid)});return !1});if(1<=k.isAdmin){var u=$('<a href="javascript:;" title="\u88ab\u9690\u85cf\u540e\uff0c\u5176\u4ed6\u7528\u6237\u4f1a\u9ed8\u8ba4\u4e0d\u663e\u793a\u8be5\u8bc4\u8bba" class="no hidefb">'+(2<=k.isAdmin?"\u5220\u9664":"\u9690\u85cf")+"\u8be5\u8bc4\u8bba</a>").prependTo(C).click(function(){adHideFB(this,h,k.type,E.fbid);return !1}),s=$('<a href="javascript:;" class="yes showfb">\u663e\u793a\u8be5\u8bc4\u8bba</a>').prependTo(C).click(function(){adShowFB(this,h,k.type,E.fbid);return !1});0==E.ad_check?s.hide():u.hide()}0<=k.isAdmin&&("arc"==k.type&&$('<a class="jubao">\u4e3e\u62a5</a>').appendTo(C).click(function(){return reportFB(this,E.fbid)}),$('<a href="javascript:;" class="zan"><b>(+'+E.good+")</b></a>").appendTo(C).click(function(){return agFB(this,h,k.type,E.fbid)}));var t,q;$('<a href="javascript:;" class="huifu">\u56de\u590d</a>').appendTo(C).click(function(){0==D.find(".reply").length?(t=$('<div class="reply"><ul class="re_ul"></ul><div class="re_box"><p class="j_re"><a class="re_send_s" href="javascript:;">\u53c2\u4e0e\u56de\u590d</a></p><div class="re_page">\t<div class="pagelistbox"></div></div></div><div class="re_send"></div></div>').appendTo(D),q=t.find(".re_ul"),$(".re_box",t).hide(),$(".re_send_s",t).click(function(){k.re_send_show(t.find(".re_send"),null,E.fbid,function(f){$(".re_more",t).remove();k.loadReply($(".pagelistbox",t),q,E.fbid,Math.ceil((E.reply_count+1)/10));$(".re_send",k.target).hide();$(".re_send",k.target).children().remove();return !1})})):t=D.find(".reply");k.re_send_show(t.find(".re_send"),null,E.fbid,function(f){$(".re_box",t).show();$(".re_more",t).remove();k.loadReply($(".pagelistbox",t),q,E.fbid,Math.ceil((E.reply_count+1)/10));$(".re_send",k.target).hide();$(".re_send",k.target).children().remove();return !1})})}(w.list[y])}k.checkFeed(k.id);var e=$('<div class="comm_send"></div>').prependTo(r);if(-1<=k.isAdmin){b=$('<div class="tg_send_post"><div class="dcmp_title"> <small id="ajaxBackMsg">\u8bf7\u81ea\u89c9\u9075\u5b88\u4e92\u8054\u7f51\u76f8\u5173\u7684\u653f\u7b56\u6cd5\u89c4\uff0c\u4e25\u7981\u53d1\u5e03\u8272\u60c5\u3001\u66b4\u529b\u3001\u53cd\u52a8\u7684\u8a00\u8bba\u3002</small> </div><div class="dcmp_content"><div class="user_face"><img src="'+(window.biliLoginStatus.isLogin?window.biliLoginStatus.face.replace("_s",""):"")+'"></div><div id="dcmp_textarea_container"><textarea cols="80" name="msg" rows="5" id="comment_text"  placeholder="\u5728\u8fd9\u91cc\u8f93\u5165\u8bc4\u8bba" class="ipt-txt"></textarea><div class="dcmp_post"><div class="ywz-wrapper"><div class="biaoqing_box" style="display:none;"><a>(\u2312\u25bd\u2312)</a><a>\uff08\uffe3\u25bd\uffe3\uff09</a><a>(=\u30fb\u03c9\u30fb=)</a><a>(\uff40\u30fb\u03c9\u30fb\u00b4)</a><a>(\u301c\uffe3\u25b3\uffe3)\u301c</a><a>(\uff65\u2200\uff65)</a><a>(\u00b0\u2200\u00b0)\uff89</a><a>(\uffe33\uffe3)</a><a>\u256e(\uffe3\u25bd\uffe3)\u256d</a><a>( \u00b4_\u309d\uff40)</a><a>\u2190_\u2190</a><a>\u2192_\u2192</a><a>(&lt;_&lt;)</a><a>(&gt;_&gt;)</a><a>(;\u00ac_\u00ac)</a><a>("\u2594\u25a1\u2594)/</a><a>(\uff9f\u0414\uff9f\u2261\uff9f\u0434\uff9f)!?</a><a>\u03a3(\uff9f\u0434\uff9f;)</a><a>\u03a3( \uffe3\u25a1\uffe3||)</a><a>(\u00b4\uff1b\u03c9\uff1b`)</a><a>\uff08/T\u0414T)/</a><a>(^\u30fb\u03c9\u30fb^ )</a><a>(\uff61\uff65\u03c9\uff65\uff61)</a><a>(\u25cf\uffe3(\uff74)\uffe3\u25cf)</a><a>\u03b5=\u03b5=(\u30ce\u2267\u2207\u2266)\u30ce</a><a>(\u00b4\uff65_\uff65`)</a><a>(-_-#)</a><a>\uff08\uffe3\u3078\uffe3\uff09</a><a>(\uffe3\u03b5(#\uffe3) \u03a3</a><a>\u30fd(`\u0414\u00b4)\uff89</a><a>(\u256f\u00b0\u53e3\u00b0)\u256f(\u2534\u2014\u2534</a><a>\uff08#-_-)\u252f\u2501\u252f</a><a>_(:3\u300d\u2220)_</a><a>(\u7b11)</a><a>(\u6c57)</a><a>(\u6ce3)</a><a>(\u82e6\u7b11)</a></div><a class="ywz"></a></div><div class="dcmp_userinfo"><div class="_qure"><div class="t"></div></div></div></div><div id="textarea_size_tester"></div></div></div></div>').appendTo(e);w.needCode&&$('\u9a8c\u8bc1\u7801\ufe30<input type="text" id="fb_vcode" value="" size="6" /><img src="/captcha" onclick="this.src=\'/captcha?r=\'+Math.random()" />').appendTo(b.find(".dcmp_post .dcmp_userinfo"));w=$('<button type="submit" class="pink b-btn">\u53d1\u8868\u8bc4\u8bba</button>').appendTo(b.find(".dcmp_post .dcmp_userinfo"));k.checkLogin(b);w.click(function(){window.biliLoginStatus.isLogin&&(k.quoteID="",k.submitFeedback(this,e))});var a=0;$(".ywz",e).click(function(){0==a?($(this).addClass("open"),$(".biaoqing_box",e).addClass("open"),$(".biaoqing_box",e).show(),$(".biaoqing_box",e).fadeIn(100),a=1):($(this).removeClass("open"),$(".biaoqing_box",e).removeClass("open"),$(".biaoqing_box",e).hide(),a=0)});$(".biaoqing_box a",e).click(function(){insertAtCursor($("#comment_text",e).get(0),$(this).html());a=0;$(".biaoqing_box",e).removeClass("open");$(".biaoqing_box",e).hide();$(".ywz",e).removeClass("open")});var A={source:function(n,f){if(!(m=n.term.match(/@([^\s]+)$/))){return !1}$.getJSON("http://interface.bilibili.com/m/friend_suggest?jsoncallback=?",{term:m[1].replace(/\u3000/g,""),rnd:Math.random()},f)},search:function(){if(!(m=this.value.match(/@([^\s]+)$/))){return !1}var f=m[1];if(255>f.charCodeAt(0)&&1>f.length||10<f.length){return !1}},focus:function(){return !1},select:function(n,f){this.value=this.value.replace(/@([^\s]*)$/,"@"+f.item.value);return !1},appendTo:"#dcmp_textarea_container",position:{my:"left top",using:function(){$(this).css("top",$("#textarea_size_tester").outerHeight());$(this).css("left",$("#textarea_size_tester").outerWidth()%$("#dcmp_textarea_container").outerWidth())}}};0<$(".ipt-txt",e).length&&$(".ipt-txt",e).bind("keyup",function(f){(m=this.value.match(/@([^\s]*)$/))?($(".ipt-txt",e).autocomplete(A).data("autocomplete")._renderItem=function(p,n){return $("<li></li>").data("item.autocomplete",n).append('<a style="text-align:left"><img src="'+n.face+'" style="border: none;height:20px;width: 20px;vertical-align: bottom;padding-right: 5px;}" />'+n.value+"</a>").appendTo(p)},$("#textarea_size_tester",e).get(0).innerText=this.value.substr(0,this.value.length-m[1].length)):$(".ipt-txt",e).autocomplete("destroy")})}else{$('<a style="cursor:help"><img src="http://static.hdslb.com/images/nologininfo.gif" /></a>').appendTo(e).click(function(){goTop();return !1})}bindCardEvent(r);"function"==typeof l&&l(r)}}}})}};function InitCardEvent(){"top"==$(card_obj).attr("direction")?($(".a_layer").css("top",$(card_obj).offset().top-$(".a_layer").outerHeight()+40+"px"),$(".a_layer > .arrow").addClass("arrow_t")):$(".a_layer").css("top",$(card_obj).offset().top+$(card_obj).outerHeight()/2-20+"px");$(card_obj).offset().left+$(".a_layer").outerWidth()+$(card_obj).width()+5>$(window).width()?($(".a_layer").css("left",$(card_obj).offset().left-5-$(".a_layer").outerWidth()+"px"),$(".a_layer > .arrow").removeClass("arrow_l"),$(".a_layer > .arrow").addClass("arrow_r")):$(".a_layer").css("left",$(card_obj).offset().left+$(card_obj).width()+5+"px");$(".a_layer").mouseover(function(){clearTimeout(evCardTimer)});$(".a_layer").mouseout(CardEventOut)}var tmrCardError=null;function ShowCardMsg(b){clearTimeout(tmrCardError);$(".a_layer").remove();$('<div class="a_layer"><div class="content"><div class="bg_top"></div><div class="msg">'+b+'</div></div><div class="arrow arrow_l" style=""></div></div>').appendTo("body");InitCardEvent()}function resetAttentionCache(){if(window.AttentionList&&window.sessionStorage&&window.sessionStorage.bili_login_status){var b=JSON.parse(window.sessionStorage.bili_login_status);b[2]=window.AttentionList;window.sessionStorage.bili_login_status=JSON.stringify(b)}}function attentionUser(f,e,g){Bilibili.attentionUser(f,e,function(a){0==a.code?(window.AttentionList.push(e),resetAttentionCache(),(new MessageBox).show(f,"\u5173\u6ce8\u6210\u529f!",1000,"ok"),"undefined"!=typeof g&&g(a)):(new MessageBox).show(f,a.msg,2000,"warning")})}function unattentionUser(f,e,g){Bilibili.delFriend(f,e,function(b){if(0==b.code){var a=window.AttentionList.indexOf(e);-1!=a&&(window.AttentionList.splice(a,1),resetAttentionCache());(new MessageBox).show(f,"\u53d6\u6d88\u5173\u6ce8\u6210\u529f!",1000,"ok");"undefined"!=typeof g&&g(b)}else{(new MessageBox).show(f,b.msg,2000,"warning")}})}function showSpAdbtn(e){if("1"==e){var c=$('<p class="b-btn w" onclick="unsubscribeSp(this,spid)">\u5df2\u8ba2\u9605</p>');c.hover(function(){c.html("\u53d6\u6d88\u8ba2\u9605")},function(){c.html("\u5df2\u8ba2\u9605")});$("#sp_dingyue").empty().append(c)}else{$("#sp_dingyue").html('<p class="b-btn dy" onclick="subscribeSp(this,spid)">\u8ba2\u9605</p>')}}function subscribeSp(g,f,j){var h=new MessageBox;$.ajax("/spadmin?action=attention&spid="+f,{success:function(a){h.show(g,"OK"==a?"\u8ba2\u9605\u6210\u529f!":a,"OK"==a?1000:2000,"OK"==a?"ok":"warning");"OK"==a&&(showSpAdbtn("1"),"undefined"!=typeof j&&j(a))},error:function(){h.show(g,"\u7cfb\u7edf\u9519\u8bef\uff0c\u8bf7\u7a0d\u540e\u91cd\u8bd5!",2000,"error")}})}function unsubscribeSp(g,f,j){var h=new MessageBox;$.ajax("/spadmin?action=unfavourite&spid="+f,{success:function(a){h.show(g,"OK"==a?"\u53d6\u6d88\u8ba2\u9605\u6210\u529f!":a,"OK"==a?1000:2000,"OK"==a?"ok":"warning");"OK"==a&&(showSpAdbtn("0"),"undefined"!=typeof j&&j(a))},error:function(){h.show(g,"\u7cfb\u7edf\u9519\u8bef\uff0c\u8bf7\u7a0d\u540e\u91cd\u8bd5!",2000,"error")}})}function postJSON(h){new MessageBox;var g=h.callback||"_jsonpCallback_"+(new Date).getTime(),l=$('<iframe name="frm'+g+'" id="frm'+g+'" style="visibility:hidden; width:1px; height:1px"></iframe>').appendTo("body"),k=$('<form action="'+h.url+'" method="POST" target="frm'+g+'"></form>').appendTo("body");"undefined"==typeof h.data&&(h.data={});h.data[h.jsonpCallback||"callback"]=g;for(var j in h.data){$('<input type="hidden" name="'+j+'" />').appendTo(k).val(h.data[j])}window[g]=function(a){"function"==typeof h.success&&h.success(a);l.remove();k.remove()};k.submit()}var Bilibili={initCrossdomain:function(){window.location.href.match(/\.bilibili\.tv/)?(Bilibili.interface_domain="interface.bilibili.tv",document.domain="bilibili.tv"):window.location.href.match(/\.bilibili\.com/)?(Bilibili.interface_domain="interface.bilibili.com",document.domain="bilibili.com"):(Bilibili.interface_domain="interface.bilibili.cn",document.domain="bilibili.cn")},badlistUser:function(f,e,g){Bilibili.initCrossdomain();"function"==typeof e?(g=e,e=f,f=null):"undefined"==typeof e&&(e=f,f=null);postJSON({url:"http://"+Bilibili.interface_domain+"/m/friend_manage.do",data:{act:"add_badlist",format:"json",uid:e},success:function(a){"undefined"==typeof g?0==a.code?(new MessageBox).show(f,"\u9ed1\u540d\u5355\u6210\u529f!",1000,"ok"):(new MessageBox).show(f,a.msg,2000,"warning"):g(a)}})},attentionUser:function(f,e,g){Bilibili.initCrossdomain();"function"==typeof e?(g=e,e=f,f=null):"undefined"==typeof e&&(e=f,f=null);postJSON({url:"http://"+Bilibili.interface_domain+"/m/friend_manage.do",data:{act:"add",attention:1,format:"json",uid:e},success:function(a){"undefined"==typeof g?0==a.code?(new MessageBox).show(f,"\u5173\u6ce8\u6210\u529f!",1000,"ok"):(new MessageBox).show(f,a.msg,2000,"warning"):g(a)}})},whisperUser:function(f,e,g){Bilibili.initCrossdomain();"function"==typeof e?(g=e,e=f,f=null):"undefined"==typeof e&&(e=f,f=null);postJSON({url:"http://"+Bilibili.interface_domain+"/m/friend_manage.do",data:{act:"add",attention:0,format:"json",uid:e},success:function(a){"undefined"==typeof g?0==a.code?(new MessageBox).show(f,"\u5173\u6ce8\u6210\u529f!",1000,"ok"):(new MessageBox).show(f,a.msg,2000,"warning"):g(a)}})},delFriend:function(f,e,g){Bilibili.initCrossdomain();"function"==typeof e?(g=e,e=f,f=null):"undefined"==typeof e&&(e=f,f=null);postJSON({url:"http://"+Bilibili.interface_domain+"/m/friend_manage.do",data:{act:"del",attention:0,format:"json",uid:e},success:function(a){"undefined"==typeof g?0==a.code?(new MessageBox).show(f,"\u5220\u9664\u6210\u529f!",1000,"ok"):(new MessageBox).show(f,a.msg,2000,"warning"):g(a)}})},delFans:function(f,e,g){Bilibili.initCrossdomain();"function"==typeof e?(g=e,e=f,f=null):"undefined"==typeof e&&(e=f,f=null);postJSON({url:"http://"+Bilibili.interface_domain+"/m/friend_manage.do",data:{act:"delFans",attention:0,format:"json",uid:e},success:function(a){"undefined"==typeof g?0==a.code?(new MessageBox).show(f,"\u5220\u9664\u6210\u529f!",1000,"ok"):(new MessageBox).show(f,a.msg,2000,"warning"):g(a)}})}};function sendCommand(j,h,o,n,l){var k=l||"\u547d\u4ee4\u6267\u884c\u6210\u529f";return(new MessageBox).show(j,h,"button",function(a){$.ajax({url:o,data:n,type:"POST",dataType:"html",success:function(c){(new MessageBox).show(j,"OK"==c?k:c,"OK"==c?500:2000,"OK"==c?"info":"warning")},error:function(){(new MessageBox({Overlap:!0,position:a.position})).show(j,"\u63d0\u4ea4\u5931\u8d25\uff0c\u53ef\u80fd\u6743\u9650\u4e0d\u8db3",2000,"error")}})})}var card_obj=null;function ShowCard(g){clearTimeout(tmrCardError);if("undefined"==typeof g.mid){ShowCardMsg("\u62b1\u6b49\uff0c\u8be5\u6635\u79f0\u76ee\u524d\u4e0d\u5b58\u5728\u54e6(*^__^*)")}else{$(".a_layer").remove();var f=!1,j=!1;if("undefined"!=typeof window.AttentionList&&"null"!=typeof window.AttentionList){for(var h=0;h<window.AttentionList.length;h++){if(window.AttentionList[h]==g.mid){j=!0;break}}}if("undefined"!=typeof g.attentions&&"null"!=typeof g.attentions){for(h=0;h<g.attentions.length;h++){if(g.attentions[h]==window.uid){f=!0;break}}}h="";j&&f?h='<i class="icon_add addbtn_b" title="\u52a0\u5173\u6ce8"></i>\u4e92\u76f8\u5173\u6ce8<span class="line">|</span><a href="javascript:;" onclick="unattentionUser(this,'+g.mid+')">\u53d6\u6d88</a>':j?f||(h='<i class="icon_add addbtn_c" title="\u5df2\u5173\u6ce8"></i>\u5df2\u5173\u6ce8<span class="line">|</span><a href="javascript:;" onclick="unattentionUser(this,'+g.mid+')">\u53d6\u6d88</a>'):h='<a href="javascript:;" onclick="attentionUser(this,'+g.mid+')"><i class="icon_add addbtn_a" title="\u52a0\u5173\u6ce8"></i>\u5173\u6ce8</a>';$('<div class="a_layer"><div class="content"><div class="bg_top"></div><div class="wrp"><div class="card"><a href="http://space.bilibili.com/'+g.mid+'" target="_blank"><img src="'+g.face+'" class="face"></a><div class="info"><div class="t"><a href="http://space.bilibili.com/'+g.mid+'" target="_blank">'+g.name+"</a>"+(g.approve?'<a href="http://www.bilibili.com/html/certified.html" target="_blank" title="\u54d4\u54e9\u54d4\u54e9\u8ba4\u8bc1" class="verified"></a>':"")+'</div><div class="address"><i class="small_icon '+("\u7537"==g.sex?"male":"\u5973"==g.sex?"female":"")+'" title="'+g.sex+'" ></i><span> '+(g.place?g.place:"\u672a\u77e5")+'</span><a href="http://member.bilibili.com/#message?mid='+g.mid+'" target="_blank">\u79c1\u4fe1</a></div></div><div class="W_addbtn_even">'+h+'</div></div><div class="cardinfo">'+(g.approve?'<div class="approve">\u8ba4\u8bc1\u8d44\u6599</div>':"")+g.description+'</div><ul class="userdata"><li><p class="t"><a href="http://space.bilibili.com/'+g.mid+'/follow.html" target="_blank">\u5173\u6ce8</a></p><p class="num"><a href="http://space.bilibili.com/'+g.mid+'/follow.html" target="_blank">'+g.attention+'</a></p></li><li class="mid"><p class="t"><a href="http://space.bilibili.com/'+g.mid+'/fans.html" target="_blank">\u7c89\u4e1d</a></p><p class="num"><a href="http://space.bilibili.com/'+g.mid+'/fans.html" target="_blank">'+g.fans+'</a></p></li><li><p class="t"><a href="http://space.bilibili.com/'+g.mid+'" target="_blank">\u6295\u7a3f</a></p><p class="num"><a href="http://space.bilibili.com/'+g.mid+'" target="_blank">'+g.article+'</a></p></li></ul></div></div><div class="arrow arrow_l" style=""></div></div>').appendTo("body");InitCardEvent()}}function ShowLoadCardFail(){clearTimeout(tmrCardError);ShowCardMsg('<span class="loading">\u52a0\u8f7d\u5931\u8d25</span>')}function LoadCard(e,c){card_obj=e;ShowCardMsg('<span class="loading">\u6b63\u5728\u52a0\u8f7d\u4e2d,\u8bf7\u7a0d\u5019..</span>');$('<script type="text/javascript" src="http://interface.bilibili.com/card/'+c+'.js" onerror="ShowLoadCardFail()">\x3c/script>').appendTo("body");clearTimeout(tmrCardError);tmrCardError=setTimeout(ShowLoadCardFail,5000)}function CardEventOver(e,c){clearTimeout(evCardTimer);evCardTimer=setTimeout(function(){clearTimeout(evCardTimer);LoadCard(e,c)},300)}function CardEventOut(){clearTimeout(evCardTimer);evCardTimer=setTimeout(function(){clearTimeout(evCardTimer);$(".a_layer").remove()},100)}function bindCardEvent(b){"undefined"!=typeof b?$(b).find("a[card]").mouseover(function(){CardEventOver(this,$(this).attr("card"))}).mouseout(CardEventOut):$("a[card]").mouseover(function(){CardEventOver(this,$(this).attr("card"))}).mouseout(CardEventOut)}var last_sug_user_start=0;function createSuggestUserList(k){var j,q=0,p=0;$("#rup_user").empty();k+5>suggest_user.length&&(k=0);for(j in suggest_user){if(q++,!("undefined"!=typeof k&&q<=k)){var o=suggest_user[j],n=!1;if("undefined"!=typeof window.AttentionList&&"null"!=typeof window.AttentionList){for(var l=0;l<window.AttentionList.length;l++){if(window.AttentionList[l]==o[0]){n=!0;break}}}if(!n&&(n=$('<li><a href="http://space.bilibili.com/'+o[0]+'" target="_blank" card="'+o[1]+'"><img src="'+o[2]+'"><div class="name">'+o[1]+'</div></a><p class="i"><a class="gz">\u5173\u6ce8</a></p><div class="info">'+o[3]+"</div></li>").appendTo("#rup_user").find(".gz"),function(e,c){c.click(function(){1==c.attr("attention")?unattentionUser(c,e,function(){c.html("\u5173\u6ce8").attr("attention",0)}):attentionUser(c,e,function(){c.html("\u53d6\u6d88\u5173\u6ce8").attr("attention",1)})})}(parseInt(o[0]),n),last_sug_user_start=q,5<=++p)){break}}}bindCardEvent()}function createSuggestSpList(h){var g,l=0,k=0;$("#rup_sp").empty();if(0==suggest_sp.length){$('<div class="no_more">\u6ca1\u6709\u66f4\u591a\u4fe1\u606f</div>').appendTo("#rup_sp")}else{for(g in h+5>suggest_sp.length&&(h=0),suggest_sp){if(l++,!("undefined"!=typeof h&&l<=h)){var j=suggest_sp[g];if("undefined"!=typeof j&&"undefined"!=typeof j[0]&&($('<li><a href="/sp/'+j[0]+'"><img src="'+j[1]+'" title="'+j[0]+'"><div class="name">'+j[0]+'</div></a><div class="info">'+(j[2]?"\u540c\u4e49\u8bcd: <i>"+j[2]+"</i>":"")+"<p>\u5171<b>"+j[3]+"</b>\u4e2a\u89c6\u9891</p></div></li>").appendTo("#rup_sp"),5<=++k)){break}}}}}function bindPOCoins(k,j){var q;if("undefined"===typeof j||!1!==j){for(var p=0;p<k.length;p++){q=parseInt($(k[p]).attr("yb")),20<=q&&60>q&&$(k[p]).find("img").css("background","url(http://static.hdslb.com/images/po-img-bg.png) no-repeat -72px -26px"),60<=q&&120>q&&$(k[p]).find("img").css("background","url(http://static.hdslb.com/images/po-img-bg.png) no-repeat -402px -26px"),120<=q&&$(k[p]).find("img").css("background","url(http://static.hdslb.com/images/po-img-bg.png) no-repeat -572px -26px")}}$.browser.msie&&k.addClass("snti");var o=0,n,l;mouseOutFunc=function(){o=0;clearInterval(n);l=setTimeout(function(){o||(clearTimeout(l),$(".ov-box").remove())},100)};k.mouseover(function(){var b=this;o=1;n=setTimeout(function(){1==o&&($(".ov-box").remove(),$('<div class="ov-box" style="display: none; "><div class="ov"><div class="title"></div><div class="subtitle"></div><img src=""><a class="gk">\u64ad\u653e:'+$(b).attr("gk")+'</a><a class="sc">\u6536\u85cf:'+$(b).attr("sc")+'</a><a class="pl">\u8bc4\u8bba:'+$(b).attr("pl")+'</a><a class="pf">(+'+$(b).attr("pf")+')</a><p class="txt"></p><p class="tg-date"></p><p class="lm"></p></div></div>').prependTo("body"),$(".ov-box").css({left:$(b).offset().left,top:$(b).offset().top-120}),$(".ov-box > .ov > .txt").html($(b).attr("txt")),$(".ov-box > .ov > .title").html($(b).find(".t").html()),$(".ov-box > .ov > .subtitle").html($(b).attr("subtitle")),$(".ov-box > .ov > .tg-date").html("\u65e5\u671f:"+$(b).attr("tg")),$(".ov-box > .ov > .lm").html("UP\u4e3b:"+$(b).attr("up")),$(".ov-box > .ov > img").attr("src",$(b).find("img").attr("src")),$(".ov-box").fadeIn(300),$(".ov-box").mouseover(function(){o=1;clearTimeout(l)}),$(".ov-box").mouseout(mouseOutFunc),clearTimeout(n))},500)});k.mouseout(mouseOutFunc)}function bindPOCoins2(k,j){var q;if("undefined"===typeof j||!1!==j){for(var p=0;p<k.length;p++){q=parseInt($(k[p]).attr("yb")),200<=q&&300>q&&$(k[p]).addClass("m200"),300<=q&&$(k[p]).addClass("m300")}}$.browser.msie&&k.addClass("snti");var o=0,n,l;mouseOutFunc=function(){o=0;clearInterval(n);l=setTimeout(function(){o||(clearTimeout(l),$(".ov-box").remove())},100)};mouseInFunc=function(){var b=this;o=1;n=setTimeout(function(){if(1==o){$(".ov-box").remove();var a=$('<div class="ov-box" style="display: none;"><div class="ov"><div class="title"></div><div class="subtitle"></div><div class="info"><i class="gk">'+formatFriendlyNumber($(b).attr("gk"))+'</i><i class="sc">'+formatFriendlyNumber($(b).attr("sc"))+'</i><i class="pl">'+formatFriendlyNumber($(b).attr("pl"))+'</i><i class="pts">'+$(b).attr("yb")+'</i></div><img src=""><p class="txt"></p><p class="lm"></p><p class="tg-date"></p></div></div>').prependTo("body");a.css({left:$(b).offset().left,top:$(b).offset().top-170});a.find(".ov > .txt").html($(b).attr("txt"));a.find(".ov > .title").html($(b).find(".t").html());a.find(".ov > .subtitle").html($(b).attr("subtitle"));a.find(".ov > .tg-date").html($(b).attr("tg"));a.find(".ov > .lm").html($(b).attr("up"));a.find(".ov > img").attr("src",$(b).find("img").attr("src"));a.fadeIn(300);clearTimeout(n)}},500)};k.hover(mouseInFunc,mouseOutFunc)}function date_format(e){var c=(new Date).getTime()/1000*e;if(86400>c&&0<c){if(60>c){return c+"\u79d2\u524d"}if(3600>c){return Math.floor(c/60)+"\u5206\u949f\u524d"}if(86400>c){return Math.floor(c/3600)+"\u5c0f\u65f6\u524d"}}else{return c=new Date,c.setTime(1000*e),c.getFullYear()+"/"+(c.getMonth()+1)+"/"+c.getDate()}}var mouIntervals=null,timi=0;$(document).ready(function(){$num=$(".num li");$num.mouseover(function(){var b=$num.index($(this));32!=b&&0!=b&&(timi=1,clearInterval(mouIntervals),$(".nums").css({left:90}),$("#zt-minibox").hide(),$("#nums").html($(this).find("ul").html()),$(".nums").slideDown(300))});$(".nums").mouseover(function(){timi=1;clearInterval(mouIntervals)});$(".nums").mouseout(numsout);$num.mouseout(numsout);$("#sp_order_alpha").click(function(){$(".s-alpha").slideDown(300)});$(".float_window .close").click(function(){$(".float_window").fadeOut(300)})});function numsout(){timi=0;mouIntervals=setTimeout(function(){0==timi&&(clearInterval(mouIntervals),$(".nums").slideUp(100))},200)}function alertCharNums(b){1000<b.value.length&&(b.value=b.value.substring(0,1000));$("#ajaxBackMsg").html("\u5b57\u7b26\u7edf\u8ba1:"+b.value.length+"/1000")}function showGlobalAlert(b){tips_str='<div class="ui-widget" id="announce_alerts" style="margin: 0px; position: fixed; top: 0px; width: 980px; z-index: 100;">\t<div class="ui-state-error ui-corner-all" style="padding: 0 .7em;"> \t\t<p><span class="ui-icon ui-icon-alert" style="float: left; margin-right: .3em;margin-top:.1em;"></span>'+b+"</p>\t</div></div>";fc=$(".z:first-child");fc.before(tips_str)}function showGlobalTips(b){tips_str='<div class="ui-widget" id="announce_tips" style="margin: 0px; position: fixed; top: 0px; width: 980px; z-index: 100;">\t<div class="ui-state-highlight ui-corner-all" style="padding: 3px .7em;"> \t\t<p><span class="ui-icon ui-icon-info" style="float: left; margin-right: .3em;"></span>'+b+"</p>\t</div></div>";fc=$(".z:first-child");fc.before(tips_str)}function insertFlash(g,f,j,h){document.getElementById(g)&&(f='<embed height="'+h+'" width="'+j+'" id="'+g+'_flash" pluginspage="http://www.adobe.com/shockwave/download/download.cgi?P1_Prod_Version=ShockwaveFlash" allowscriptaccess="always" style="visibility:hidden"  src="'+f+'" type="application/x-shockwave-flash" allowfullscreen="true" quality="high">',document.getElementById(g).innerHTML=f)}var cb_controler;function cb_initOnlineInfo(){}function cb_packet(e,c){}function cb_getOnline(b){$("#wait_online").html(b)}function cb_chatlog(f,e,g){}function cb_onconnect(e,c){"undefined"!=typeof window.connect_cid&&setInterval(function(){cb_controler.getChatRoom()},30000)}function cb_initok(){cb_controler.setConnectParam(window.connect_cid?window.connect_cid:1,__GetCookie("DedeUserID")?__GetCookie("DedeUserID"):0,"")}var scrollActivate=!0;function goTop(u,t,s){if(scrollActivate){u=u||0.1;t=t||16;var r=0,q=0,p=0,o=0,l=0,j=0;document.documentElement&&(r=document.documentElement.scrollLeft||0,q=document.documentElement.scrollTop||0);document.body&&(p=document.body.scrollLeft||0,o=document.body.scrollTop||0);l=window.scrollX||0;j=window.scrollY||0;r=Math.max(r,Math.max(p,l));q=Math.max(q,Math.max(o,j));o=1+u;window.scrollTo(Math.floor(r/o),Math.floor(q/o));0<r||0<q?window.setTimeout("goTop("+u+", "+t+")",t):"undefined"!=typeof s&&s()}else{scrollActivate=!0}}if("function"==typeof Object.defineProperty){try{Object.defineProperty(Array.prototype,"shuffle",{enumerable:!1,writable:!0})}catch(error$$3){}Array.prototype.shuffle=function(){for(var f,e,g=this.length;g;f=parseInt(Math.random()*g),e=this[--g],this[g]=this[f],this[f]=e){}return this}}array_shuffle=function(g){for(var f,j,h=g.length;h;f=parseInt(Math.random()*h),j=g[--h],g[h]=g[f],g[f]=j){}return g};function loadNotify(){"http:"==document.location.protocol&&($('<div id="cb_controler"></div>').appendTo("body"),insertFlash("cb_controler","http://static.hdslb.com/images/bili_notify.swf",0,0),cb_controler=$("#cb_controler_flash").get(0))}function reloadFeedback(){window.feedback_object?window.feedback_object.show(window.feedback_object.id,1):0<$("#fb_tp_id").length?loadTopicFB($("#fb_tp_id").val(),1):0<$("#fb_aid").length?loadFB($("#fb_aid").val(),1):loadFB($("#fb_news_id").val(),1)}function CallPlayerAction(b){switch(b){case 1:b=1<=$("#comment_container").length,0==$("#review_comments_tips").length&&$('<div class="new_comm"><span id="review_comments_tips" tag="0"></span></div>').prependTo(b?"#comment_container>ul":".comm > ul"),num=parseInt($("#review_comments_tips").attr("tag"))+1,$("#review_comments_tips").attr("tag",num),$("#review_comments_tips").empty(),$("<b>"+num+'</b> \u6761\u65b0\u7684\u8bc4\u8bba\u4fe1\u606f<a href="javascript:reloadFeedback();" style="font-weight:bold">\u70b9\u51fb\u67e5\u770b</a>').appendTo("#review_comments_tips")}}window.loginCallbacks=[];function onLoginInfoLoaded(b){"undefined"!=typeof window.biliLoginStatus?b(window.biliLoginStatus):window.loginCallbacks.push(b)}function loadLoginInfo(g,f){window.biliLoginStatus=g;if(g.isLogin){var j=$("#dynamic_num_total"),h=0;for(d in g.dynamic){h+=parseInt(g.dynamic[d])}0<h&&j.html(h).show();g.dynTotalNum=h;$(".z_top .board").show();$('li[guest="no"]').show();$('li[guest="yes"]').hide();$(".i_face").attr("src",g.face);j=$("#i_menu_profile");$(".uname",j).html("<b>"+g.uname+"</b>");$(".coin",j).html("<b>\u786c\u5e01\uff1a</b>"+g.money);$(".score",j).html("<b>\u79ef\u5206\uff1a</b>"+g.scores);parseInt(__GetCookie("_cnt_at"))&&($("#i_menu_msg_btn").addClass("tips"),$("#at_num").html(parseInt(__GetCookie("_cnt_at"))),$("#at_num").show());h&&($("#i_menu_msg_btn").addClass("tips"),$("#dynamic_num").html(h),$("#dynamic_num").show());parseInt(g.dynamic.r)&&($("#i_menu_msg_btn").addClass("tips"),$("#review_num").html(parseInt(g.dynamic.r)),$("#review_num").show());parseInt(g.notify)&&($("#i_menu_msg_btn").addClass("tips"),$("#notify_num").html(parseInt(g.notify)),$("#notify_num").show());parseInt(g.pm)&&($("#i_menu_msg_btn").addClass("tips"),$("#pm_num").html(parseInt(g.pm)),$("#pm_num").show(),pmNoticeWnd());initDynWnd(g);initMiniWnd(!0);initDrawyooDyn()}else{$(".z_top .board").hide(),$('li[guest="no"]').hide(),$('li[guest="yes"]').show(),initMiniWnd(!1)}!f&&window.sessionStorage&&(h=[(new Date).getTime()+300000],h.push(g),h.push(window.AttentionList),h.push(window.uid),window.sessionStorage.bili_login_status=JSON.stringify(h));for(h=0;h<loginCallbacks.length;h++){loginCallbacks[h](g)}}function loadLoginStatus(){var f,e=function(){$('<script type="text/javascript" src="http://interface.bilibili.com/nav.js">\x3c/script>').appendTo("body")};try{window.sessionStorage&&(f=window.sessionStorage.bili_login_status)&&(f=JSON.parse(f))&&(new Date).getTime()<f[0]&&(!__GetCookie("DedeUserID")&&void 0===f[3]||parseInt(__GetCookie("DedeUserID"))==f[3])?(window.AttentionList=f[2],window.uid=f[3],loadLoginInfo(f[1],!0)):e()}catch(g){e()}}(function(b){b.fn.smoothScroll=function(f,h){var g=this;this.step=f?f.step||100:100;this.f=f?f.f||0.1:0.1;this.interval=10;this.intervalID=null;this.isFF=0<=navigator.userAgent.toLowerCase().indexOf("firefox");this.upOrDown="";this.init=function(e){var c=this;c.isFF?e.addEventListener("DOMMouseScroll",function(a){c.upOrDown=0>a.detail?"up":"down";c.scrollHandler(e);a.preventDefault()},!1):e.onmousewheel=function(a){a=a||window.event;c.upOrDown=0<a.wheelDelta?"up":"down";c.scrollHandler(e);a.preventDefault?a.preventDefault():a.returnValue=!1}};this.scrollHandler=function(j){var c=this;clearInterval(c.intervalID);var k=j.scrollTop+c.step*("up"==c.upOrDown?-1:1);c.intervalID=setInterval(function(){j.scrollTop+=(k-j.scrollTop)*c.f;k!=j.scrollTop&&j.scrollTop!=c.lastScrollTop||clearInterval(c.intervalID);c.lastScrollTop=j.scrollTop},c.interval)};g.each(function(e,c){g.init(c)});return this}})(jQuery);function pmNoticeWnd(){}function initDynWnd(l){var j=$('<div id="dyn_wnd"><div class="dyn_arrow"></div><div class="dyn_menu"><b>\u4fe1\u606f\u52a8\u6001</b><div class="menu"><ul><li mode="video" class="on">\u89c6\u9891</li><li mode="review">\u8bc4\u8bba<div class="num" id="review_num"></div></li></ul><div class="line"></div></div></div><div class="dyn_list_wrapper" mode="video"><ul class="dyn_list" mode="video"><li class="loading">loading...</li></ul></div><div class="dyn_list_wrapper" mode="review" style="display:none;"><ul class="dyn_list" mode="review"><li class="loading">loading...</li></ul></div><div class="wnd_bottom"><div class="r-l"><a class="read-more" href="http://www.bilibili.com/account/dynamic">\u67e5\u770b\u5168\u90e8</a><div class="num" id="dynamic_num"></div><div class="check-all no-select"></div></div></div></div>'),s=$("#i_menu_msg_btn");window.dynObjects={};if(0!=s.length){j.appendTo(s);var r=parseInt(j.css("border-left-width"));j.css({top:(($(".board").outerHeight()||s.outerHeight())-s.outerHeight())/2+s.outerHeight(),left:-j.outerWidth()/2+s.outerWidth()/2});var q=$(".dyn_arrow",j);1220>=$(window).width()&&(j.css({left:"auto",right:-60}),q.css({left:"auto",right:60-r+s.outerWidth()/2-q.width()/2}));$(".dyn_list_wrapper",j).smoothScroll();r=0;for(d in l.dynamic){"r"!=d&&(r+=parseInt(l.dynamic[d]))}r={type:"video",wnd:$("#dyn_wnd"),data:{pagesize:5,include_types:"VIDEO,SPECIAL_ADDVIDEO,SPECIAL_ADDBANGUMI",type:"jsonp"},target:$('.dyn_list[mode="video"]',j),menuItem:$('.dyn_menu li[mode="video"]',j),append:function(u){var t="",z="",A="",y="",x="",w="",v="";switch(u.dyn_type){case"VIDEO":t=u.cover;z=u.uname;v='card="'+u.uname+'"';A="<span>\u6295\u7a3f\u4e86</span>";y=u.title;x="http://space.bilibili.com/"+u.mid;w=u.link;break;case"REVIEW":t=u.face;z=u.uname;v='card="'+u.uname+'"';A="<span>\u53d1\u8868\u4e86\u8bc4\u8bba</span>";y=u.msg;x="http://space.bilibili.com/"+u.mid;w=u.follow_link;break;case"SPECIAL_ADDVIDEO":case"SPECIAL_ADDBANGUMI":t=u.sp_cover;z=u.title;A="SPECIAL_ADDVIDEO"==u.dyn_type?"<span>\u6dfb\u52a0\u4e86</span>":"<span>\u66f4\u65b0\u4e86</span>";y=u.stitle;x=u.link;w="http://www.bilibili.com/video/av"+u.aid+"/";break;case"SPECIAL":t=u.cover,z=u.uname,v='card="'+u.uname+'"',A="<span>\u521b\u5efa\u4e86\u4e13\u9898</span>",y=u.title,x="http://space.bilibili.com/"+u.mid,w=u.link}return $('<li class="d-data"><div class="preview'+("VIDEO"==u.dyn_type?" v":"")+'"><img src="'+t+'" /></div><div class="r"><div class="title">'+("SPECIAL_ADDVIDEO"==u.dyn_type||"SPECIAL_ADDBANGUMI"==u.dyn_type?'<span class="sp">\u4e13\u9898</span>':"")+'<a href="'+x+'"'+(""!=v?v:"")+' target="_blank">'+z+"</a>"+A+'</div><div class="info"><a href="'+w+'" target="_blank" title="'+("REVIEW"!=u.dyn_type?y:u.title)+'">'+y+"</a></div></div></li>")},total:r,history:!0};l={type:"review",wnd:r.wnd,data:{pagesize:5,include_types:"REVIEW",type:"jsonp"},target:$('.dyn_list[mode="review"]',j),menuItem:$('.dyn_menu li[mode="review"]',j),append:r.append,total:parseInt(l.dynamic.r),history:!0};var p=new dynManage(r),o=new dynManage(l);l=window.dynObjects={video:p,review:o};window.defaultDynObj=p;var n=null;s.hover(function(){clearTimeout(n);if(!j.is(":visible")||1>parseInt(j.css("opacity"))){n=setTimeout(function(){j.stop().fadeIn("fast",function(){var b=window.defaultDynObj;b.target.attr("loaded")||(b.init(),b.target.attr("loaded",1))})},300)}},function(){clearTimeout(n);n=setTimeout(function(){j.stop().fadeOut("fast")},300)});j.delegate(".dyn_menu li","click",function(){var b=$(this);if(!b.hasClass("on")){$(".dyn_menu li",j).removeClass("on");b.addClass("on");var c=b.attr("mode");$(".dyn_list_wrapper",j).hide();$('.dyn_list[mode="'+c+'"]',j).parent().fadeIn("fast");$(".dyn_menu .line",j).animate({left:b.position().left,width:b.outerWidth()},200);switch(c){case"video":p.init();break;case"review":$("#review_num").html("").hide(),o.init()}}});return l}}function MiniWnd(){this.wnds=[]}MiniWnd.prototype={init:function(f,e){var g=this;"object"!=typeof e.wnd&&(e.wnd=$(e.wnd));e.wnd.appendTo(f);g.setPos(f,e.wnd);"undefined"==typeof e.timer&&(e.timer=null);f.hover(function(){g.show(e)},function(){g.hide(e)});g.wnds.push(e)},setPos:function(e,c){c.css({left:-c.width()/2+e.width()/2,top:e.height()-1})},show:function(f,e){var g=this;clearTimeout(f.timer);if(!f.wnd.is(":visible")||1>parseInt(f.wnd.css("opacity"))){f.timer=setTimeout(function(){f.wnd.stop().fadeIn("fast");g.get(f);"undefined"!=typeof e&&e()},300)}},hide:function(e,c){clearTimeout(e.timer);this.timer=setTimeout(function(){e.wnd.stop().fadeOut("fast",function(){"undefined"!=typeof c&&c()})},300)},get:function(e){if(0==e.wnd.find(".m-w-loading").length){var c=$('<div class="m-w-loading">loading...</div>').appendTo(e.wnd.find(".list"))}if("undefined"==typeof e.loading||1!=e.loading){e.loading=1,"undefined"==typeof e.data?$.get(e.url,function(a){e.loading=0;e.data=a;c.remove();e.render(e.wnd,a)},"jsonp").error(function(){e.loading=0;c.html("\u7f51\u7edc\u9519\u8bef")}):(e.loading=0,c.remove())}}};function initMiniWnd(l){function j(b){return{year:b.getFullYear(),month:b.getMonth()+1,day:b.getDate()}}function s(e,c){return null==e||null==c?0:e.year==c.year&&e.month==c.month&&e.day==c.day?1:0}var r=$("#i_menu_fav_btn"),q=$("#i_menu_history_btn"),p=new MiniWnd,o={wnd:$('<div class="mini-wnd"><div class="arrow-t"></div><div class="m-w-head"><b class="t left">\u6700\u8fd1\u6536\u85cf</b><a class="right" href="http://member.bilibili.com/#favorite_manage" target="_blank">\u67e5\u770b\u66f4\u591a\u6536\u85cf></a></div><ul class="list"></ul></div>'),url:"http://interface.bilibili.com/widget/getFav",render:function(g,f){var h=g.find(".list");h.empty();for(var k in f){"object"==typeof f[k]&&(null!=f[k].title?$('<li><a href="/video/av'+f[k].aid+'" target="_blank" title="'+f[k].title+'">'+f[k].title+"</a></li>"):$('<li><a href="/mylist'+f[k].lid+'" target="_blank" title="'+f[k].description+'">'+f[k].description+"</a></li>")).appendTo(h)}0==h.children().length&&$('<li class="no-data">\u6ca1\u6709\u6570\u636e\u54e6\uff0c\u591a\u6536\u85cf\u70b9\u89c6\u9891\u5427</li>').appendTo(h)}},n={wnd:$('<div class="mini-wnd"><div class="arrow-t"></div><div class="m-w-head"><a class="right" href="http://www.bilibili.com/account/history" target="_blank">\u67e5\u770b\u66f4\u591a\u8bb0\u5f55></a></div><ul class="list history"></ul></div>'),url:"http://interface.bilibili.com/widget/getHistory",render:function(y,x){var w=y.find(".list");w.empty();x=x.list;var v=null,u=j(new Date),t;for(t in x){if("object"==typeof x[t]){var c=j(new Date(1000*x[t].view)),z=j(new Date(1000*(x[t].view+86400)));if(1!=s(c,v)){var v=c,b=$('<li class="timeline"><span class="dot"></span><span class="date"></span></li>').appendTo(w);1==w.find(".timeline").length&&(b.addClass("top"),$('<span class="d-line"></span>').insertAfter(w.find(".dot")));1==s(c,u)?b.find(".date").html("\u4eca\u65e5"):1==s(z,u)?b.find(".date").html("\u6628\u65e5"):b.find(".date").html(x[t].view_at)}(null!=x[t].title?$('<li><a href="/video/av'+x[t].aid+'" target="_blank" title="'+x[t].title+'">'+x[t].title+"</a></li>"):$('<li><a href="/mylist'+x[t].lid+'" target="_blank" title="'+x[t].description+'">'+x[t].description+"</a></li>")).appendTo(w)}}0==w.children().length&&(w.addClass("empty"),$('<li class="no-data">\u6ca1\u6709\u6570\u636e\u54e6\uff0c\u591a\u770b\u70b9\u89c6\u9891\u5427</li>').appendTo(w))}};l&&(p.init(r,o),p.init(q,n))}function initDrawyooDyn(){var f=$("#dyn_wnd"),e=f.find(".menu"),e=$('<li mode="draw">\u753b\u53cb</li>').insertAfter(e.find('li[mode="video"]'));$('<div class="dyn_list_wrapper" mode="draw" style="display:none;"><ul class="dyn_list" mode="draw"><li class="loading">loading...</li></ul></div>').insertAfter(f.find(".dyn_list_wrapper:eq("+(e.index()-1)+")")).smoothScroll();e={type:"draw",wnd:f,apiUrl:"http://interface.bilibili.com/widget/getDynamic",data:{pagesize:5,include_types:"APP",type:"jsonp"},target:$('.dyn_list[mode="draw"]',f),menuItem:$('.dyn_menu li[mode="draw"]',f),append:function(b){return $('<li class="d-data"><a href="'+b.link+'" target="_blank"><div class="preview p"><img src="'+b.cover+'" /></div></a><div class="r p"><div class="title"><a href="http://h.bilibili.com/member?mod=space&uid='+b.mid+'&act=p_index" target="_blank">'+b.uname+"</a><span>"+b.action+'</span></div><div class="info"><a href="'+b.link+'" target="_blank" title="'+b.title+'">'+b.title+"</a></div></div></li>")},history:!0};f.find(".dyn_menu li").click(function(){g.init()});var g=new dynManage(e);window.dynObjects.draw=g}function dynManage(b){this.params=b;this.wnd=b.wnd;this.num=this.page=0;this.append=b.append;this.data=b.data||{};this.target=b.target;this.wrapper=b.wrapper||b.target.parent();this.reload=this.loading=this.finish=0;this.tempList=null;this.history=b.total&&!b.history?0:1;this.historyMaxNum=b.historyMaxNum||20;this.newTag=b.newTag?!0:!1;this.tryTime=0;this.TRY_MAX=3;this.apiUrl=b.apiUrl||"http://interface.bilibili.com/widget/getDynamic";this.bindScroll()}dynManage.prototype={bindScroll:function(){var b=this;b.wrapper.on("scroll",function(){b.scroll()})},init:function(){this.target.attr("loaded")||(0==this.params.total&&($(".loading",this.target).remove(),this.noData()),this.load(),this.target.attr("loaded",1))},load:function(){var b=this;b.finish?b.complete():(b.page++,b.data.page=b.page,b.setLoading(1),$.ajax({url:b.apiUrl,dataType:"jsonp",data:b.data,success:function(a){if(a.code){b.accessError()}else{var j=0,h;for(h in a.list){if("object"!=typeof a.list[h]){break}if(!b.history&&b.num>=b.params.total){j=1;break}else{if(b.history&&b.num-b.params.total>=b.historyMaxNum&&b.num>=b.params.total){j=2;break}}var g=$(b.append(a.list[h])).insertBefore(b.getLoading().elem);b.newTag&&b.num<b.params.total?$('<div class="new">new</div>').appendTo(g):b.num==b.params.total&&($('<li class="d-data history"><div class="history-tag">\u5386\u53f2\u52a8\u6001</div></li>').insertBefore(g),g.addClass("no-border"));b.renderEffect(g);b.num++}b.setLoading(0);b.page>=a.pages||0!=j?b.complete():b.target.is(":visible")&&b.target.height()-b.getLoading().elem.height()<b.wrapper.height()&&b.load()}},error:function(){b.accessError()}}))},accessError:function(){var b=this;b.page--;b.data.page=b.page;b.tryTime<b.TRY_MAX?(b.getLoading().elem.addClass("error").html("(\u00b4\u30fb\u03c9\u30fb\uff40)\u7f51\u7edc\u9519\u8bef\uff0c\u6b63\u5728\u91cd\u8bd5"),b.load(),b.tryTime++):b.getLoading().elem.addClass("error m").html("(\u00b4\u30fb\u03c9\u30fb\uff40)\u7f51\u7edc\u9519\u8bef\uff0c\u8bf7\u70b9\u51fb\u8fd9\u91cc\u91cd\u65b0\u5c1d\u8bd5").click(function(){$(this).removeClass("error m").html("loading...");b.load();$(this).off("click")})},renderEffect:function(b){b.css({"margin-left":"50px",opacity:"0"});b.animate({"margin-left":"0",opacity:"1"},300)},complete:function(){this.finish=1;0<this.getNoData().length&&0==this.num?(this.wrapper.addClass("no-history").animate({height:120},100),this.getLoading().elem.remove()):this.getLoading().elem.addClass("f").html("(\u00b4\u30fb\u03c9\u30fb\uff40)\u6ca1\u6709\u66f4\u591a\u4fe1\u606f")},getNoData:function(){return $(".no-data",this.target)},noData:function(b){b=b||"\u6682\u65f6\u6ca1\u6709\u65b0\u52a8\u6001\u4e86\u54e6\uff01";0==this.getNoData().length&&$('<li class="no-data">'+b+"</li>").appendTo(this.target).hide().fadeIn(200)},getLoading:function(){return{elem:$(".loading",this.target),state:this.loading}},setLoading:function(b){b?(0==this.getLoading().elem.length&&$('<li class="loading">loading...</li>').appendTo(this.target),this.loading=1):this.loading=0},readData:function(){var b=this;$("li",b.target).fadeOut("200",function(){$(this).remove();null!=b.tempList?(b.tempList.css({"margin-left":"-50px",opacity:"0"}),b.tempList.appendTo(b.target),b.tempList.animate({"margin-left":"0",opacity:"1"},300)):b.load();b.reload=0})},removeData:function(){var b=this;$("li",b.target).animate({"margin-left":"-=50px",opacity:"0"},300,function(){$(this).is(":last-child")&&b.noData();$(this).remove()})},scroll:function(){$(".loading",this.target);this.wrapper.scrollTop()+50>=this.target.height()-this.wrapper.height()&&(!this.loading&&!this.finish&&!this.reload)&&this.load()},initMenu:function(){var g=this.wnd,f=g.find(".menu"),j=this.params.menuItem;f.find("li").removeClass("on");f.find('li[mode="'+window.defaultDynObj.params.type+'"]').addClass("on");var h=0;f.find("li").each(function(e,c){c=$(c);c.index()<j.index()&&(h+=c.width())});f.find(".line").css({left:h,width:j.outerWidth()});g.find(".dyn_list_wrapper").hide();g.find('.dyn_list_wrapper[mode="'+window.defaultDynObj.params.type+'"]').show()}};var lazyLoadContents=[];function LazyLoad(e){if("undefined"!=typeof e.render){var c={options:{url:null,xhrParams:null,wrapper:e.wrapper||$(window),target:null,offsetTop:0,distance:50,autoLoad:!0,showPageAfter:null,pageContainer:null,onInit:function(){},render:function(b){},onScroll:function(){return !1},renderCallback:function(g,f){},beforeLoad:function(){},onComplete:function(b){},onData:null,state:null,noDataPrompt:null},page:0,num:0,totalPage:1,showPages:1,totalResults:0,manualLoad:!1,waitManualOperate:!1,_busying:!1,_debug:!1,_destroyed:!1,init:function(){var a=this;if("object"==typeof e){for(var f in this.options){e.hasOwnProperty(f)&&(this.options[f]=e[f])}this.options._super=this;this.options.onData=this.options.onData||function(){return a.page<a.totalPage};this.target=this.options.target=$(this.options.target);this.options.wrapper=$(this.options.wrapper);this.options.state=$(this.options.state);this.options.state.parent().length||this.options.state.appendTo(this.options.target);this._debug&&console.log("lazyLoad: add lazyLoader "+this.options.xhrParams.url,"current counts: ",lazyLoadContents.length);if(!1!==this.options.autoLoad){if(this.options.wrapper.on("scroll",function(){a.scroll()}),"number"==typeof this.options.autoLoad){this.options.state.on("click",function(){a.load()})}}else{this.waitManualOperate=!0}this.options.onInit.call(this)}},empty:function(){this.options.target.empty();this.options.state.parent().length||this.options.state.appendTo(this.options.target)},abort:function(){this.ajaxRequest&&this.ajaxRequest.abort();this._busying=!1},free:function(){this.abort();this._destroyed=!0;for(var b=0;b<lazyLoadContents.length;b++){if(lazyLoadContents[b]==this){lazyLoadContents.splice(b,1);break}}},load:function(){var h=this,g=this.options;if(!this._busying&&!this._destroyed){if("undefined"!=typeof g.showPageAfter&&(1<this.showPages&&this.page>=g.showPageAfter||1===g.showPageAfter&&1<this.totalPage)&&0==this.page%g.showPageAfter&&0!=this.page&&!this.manualLoad){this.waitManualOperate=!0,g.state.hide()}else{this.manualLoad=!1;this.waitManualOperate=!1===g.autoLoad?!0:!1;this._busying=!0;g.beforeLoad.call(this);this.page++;this.num++;this._debug&&console.log("loading page: "+this.page+" (URL: "+g.url+this.page+")");var j=g.xhrParams.call(this);j&&(g.success=j.success,g.error=j.error,j.success=function(a){h._busying=!1;g.success&&g.success.call(h,a);"number"==typeof g.autoLoad&&h.num>=g.autoLoad&&(h.waitManualOperate=!0);g.onComplete.call(h,a)},j.error=function(b,a){g.error&&g.error.call(h,b,a)});this.ajaxRequest=$.ajax(j)}}},render:function(j){var h=this.options,l;for(l in j){if("object"==typeof j[l]&&l.match(/^[0-9]+$/)){var k=$(h.render(j[l]));h.target[0]==h.state.parent()[0]?k.insertBefore(h.state):k.appendTo(h.target);"undefined"!=typeof h.renderCallback&&h.renderCallback(k,j[l])}}},scroll:function(){if(this.waitManualOperate){return !1}var b;b="function"==typeof this.options.offsetTop?this.options.offsetTop.call(this):this.options.offsetTop;this.options.target.is(":visible")&&this.options.wrapper.scrollTop()+this.options.distance>=b+this.options.target.height()-this.options.wrapper.height()&&!this._busying&&!this.finish&&!this.reload&&this.options.onScroll.call(this)&&this.options.onData.call(this)&&this.load()},showPage:function(){var h=this,g=this.options,j=Math.ceil(this.page/g.showPageAfter);this._debug&&console.log("Current show page: "+j+"  data page: "+this.page);pagelist_ul($(g.pageContainer),j,Math.ceil(this.totalPage/g.showPageAfter),this.totalResults,function(a){h.num=0;h.manualLoad=!0;h.page=(a-1)*g.showPageAfter;h.empty();h.load()},5)}};lazyLoadContents.push(c);return c}}function lazyLoadContent(f){f.xhrParams=function(){var a=this,h=a.options;return{url:f.url+a.page,dataType:"json",success:function(b){a.render(b);a.totalPage=b.numPages;a.totalResults=b.numResults;a.showPages="undefined"!=typeof h.showPageAfter?Math.ceil(a.totalPage/h.showPageAfter):!1;a._debug&&console.log("loaded page: "+a.page+" Total: "+b.numPages+" (URL: "+h.url+a.page+")");a.page>=b.numPages?(h.state.find("> img").hide(),h.noDataPrompt?h.state.find("> b").html(h.noDataPrompt):h.state.hide()):(h.state.show(),h.state.find("> img").show(),h.state.find("> b").html("\u67e5\u770b\u66f4\u591a..."),setTimeout(function(){0!=$(h.target).height()&&a.scroll()},100));0!=a.page%h.showPageAfter&&1!==h.showPageAfter||a.manualLoad?$(h.pageContainer).hide():(a.waitManualOperate=!0,h.state.hide());(0==a.page%h.showPageAfter||a.page>=b.numPages||1===h.showPageAfter)&&1<a.showPages&&($(h.pageContainer).show(),a.showPage())}}};f.beforeLoad=function(){var b=this.options;b.state&&(b.state.show(),b.state.find("> img").attr("src","http://static.hdslb.com/images/loadinglit.gif"),b.state.find("> b").html("\u6b63\u5728\u8f7d\u5165\u4e2d..."))};var e=f.onComplete;f.onComplete=function(b){e&&e.call(this,b);0==this.target.children().length&&0==$(".nomore",this.target).length&&$('<div class="nomore"></div>').appendTo(this.target)};f.offsetTop=function(){return this.options.target.offset().top};f.onInit=function(){var b=this;this.options.state&&(this.options.state.empty(),$('<img src="http://static.hdslb.com/images/loadinglit.gif"> <b>\u521d\u59cb\u5316\u4e2d...</b>').appendTo(this.options.state).find("b").click(function(){b.load()}),this.options.state.css("cursor","pointer"))};var g=LazyLoad(f);g.init();return g}function biliShowAds(u,t,s,r,q){var p={index:{thin:{".ad-b1":{width:720,height:60},".ad-b2":{width:720,height:60},".ad-b3":{width:970,height:60},".ad-b4":{width:720,height:60},".ad-b5":{width:720,height:60},".ad-c1":{width:230,height:70},".ad-c2":{width:230,height:70},".ad-c2-2":{width:230,height:70},".ad-c3":{width:230,height:70},".ad-c4":{width:230,height:70}},wide:{".ad-b1":{width:885,height:65},".ad-b2":{width:885,height:65},".ad-b3":{width:1170,height:70},".ad-b4":{width:885,height:65},".ad-b5":{width:885,height:65},".ad-c1":{width:250,height:80},".ad-c2":{width:250,height:80},".ad-c2-2":{width:250,height:80},".ad-c3":{width:250,height:80}}},list:{thin:{".ad-b1":{width:720,height:60},".ad-b2":{width:720,height:60},".ad-b3":{width:720,height:60},".ad-b4":{width:720,height:60},".ad-b5":{width:720,height:60},".ad-c1":{width:230,height:70},".ad-c2":{width:230,height:70},".ad-c3":{width:230,height:70},".ad-c4":{width:230,height:70}},wide:{".ad-b1":{width:885,height:65},".ad-b2":{width:885,height:65},".ad-b3":{width:885,height:65},".ad-b4":{width:885,height:65},".ad-b5":{width:885,height:65},".ad-c1":{width:250,height:80},".ad-c2":{width:250,height:80},".ad-c3":{width:250,height:80}}},arc:{thin:{".ad-e1":{width:980,height:100},".ad-f":{width:468,height:60},".ad-fl":{width:468,height:60},".ad-fr":{width:468,height:60}},wide:{".ad-e1":{width:1160,height:100},".ad-f":{width:468,height:60},".ad-fl":{width:468,height:60},".ad-fr":{width:468,height:60}}}};try{var o=(new Date).getSeconds()%q.length,l=q[o];q="";void 0!==p[u][s?"wide":"thin"][r]&&(q=' width="'+p[u][s?"wide":"thin"][r].width+'" height="'+p[u][s?"wide":"thin"][r].height+'"');$(r+" #a_ds_"+t).remove();"i"==l[0]?$('<a id="a_ds_'+t+'" href="'+l[3]+'" target="_blank"><img src="'+(s?l[2]:l[1])+'"'+q+' border="0" /></a>').appendTo(r):$('<embed id="a_ds_'+t+'" wmode="opaque" pluginspage="http://www.adobe.com/shockwave/download/download.cgi?P1_Prod_Version=ShockwaveFlash" allowscriptaccess="none" rel="noreferrer" src="'+(s?l[2]:l[1])+'"'+q+' type="application/x-shockwave-flash" allowfullscreen="true" quality="high">').appendTo(r);$(r).show()}catch(j){}}var LazyJSONLoader=function(){};LazyJSONLoader.prototype={cache:{},queue:{},getJSON:function(g,f,j){var h=this;if("undefined"!=typeof this.cache[g]){f(this.cache[g])}else{"undefined"==typeof h.queue[g]&&(h.queue[g]=[]);h.queue[g].push(f);if(1<h.queue[g].length){return !1}$.getJSON(g,function(a){h.cache[g]=a;for(var e;e=h.queue[g].shift();){e(a)}}).error(function(){"undefined"!=typeof j&&j()})}}};function biliAdjust(f){var e=1400<=$(document).width();if(void 0===window.oldWideState||window.oldWideState!=e||"boolean"==typeof f&&f){if((window.oldWideState=e)?$("body").addClass("widescreen"):$("body").removeClass("widescreen"),void 0!==window.ads){for(var g in window.ads){window.ads[g](e)}}}}function _bili_crossdomain(k,j){var q={},p=!1,o;for(o in k){var n="crossdomain_flag"==o?"1":__GetCookie(o);""==n&&!1===k[o]||(n==k[o]||encodeURIComponent(n)==k[o])||(q[o]=n,p=!0)}if(p){var p="http://interface.bilibili.com/crossdomain_cookie.do?callback=?",l;for(l in q){p+="&"+l+"="+encodeURIComponent(q[l])}$.getJSON(p,j)}}function biliCachedJSON(k,j,q,p,o){k={url:k,type:"GET",dataType:"json",success:p};var n;if(window.sessionStorage){try{k.success=function(b){n=[(new Date).getTime()+1000*q,b];window.sessionStorage[j]=JSON.stringify(n);"function"==typeof p&&p(b)},void 0===(n=window.sessionStorage[j])?$.ajax(k):(n=JSON.parse(n),2!=n.length?$.ajax(k):(new Date).getTime()<n[0]&&("function"!=typeof o||o(n[1]))?p(n[1]):$.ajax(k))}catch(l){$.ajax(k)}}else{$.ajax(k)}}var SelectModule=function(){function b(c){this.params={};this._isMobile=browser.version.mobile||browser.version.ios||browser.version.android||browser.version.windowsphone;if("undefined"!=typeof c&&(this.params="string"==typeof c||c instanceof $?{item:c}:c,this.obj=$(this.params.item),this.obj.length)){this.obj.hasClass("b-slt")||(this.obj=this.obj.find(".b-slt"));this._open=!1;if("undefined"!=typeof this.params.onInit){this.params.onInit(this.obj)}if(0==this.obj.children().length||this.params.selectorData){this.obj=this.createMenu(this.obj)}this.list=this.obj.find(".list");this.init()}}window.bindSlt=b.bind=function(a){return new b(a)};b.create=function(j){var t=$('<div class="b-slt"></div>');$("<span>").addClass("txt").appendTo(t);$("<div>").addClass("b-slt-arrow").appendTo(t);var r=$("<ul>").addClass("list").appendTo(t);j.wrapper&&t.wrap(j.wrapper);for(var q=j.items||[],p=0;p<q.length;p++){var o=q[p],l=$("<li></li>").text(o.name).appendTo(r);o.selected&&l.attr("selected","selected");if(o.attributes){for(var s in o.attributes){l.attr(s,o.attributes[s])}}}j.wrapper&&(t=t.parent());return t};b.prototype.init=function(){var f=this.obj,h=this,g=this.list.find("[selected]");0==g.length&&(g=this.list.find("li").eq(0).attr("selected","selected"));f.find(".txt").html(g.html());f.off("mouseenter.selectMenu");f.off("mouseleave.selectMenu");f.off("click.selectMenu");f.on("click",function(c){h._tap(c)});this._isMobile||(f.on("mouseenter.selectMenu",function(c){h._mover(c)}),f.on("mouseleave.selectMenu",function(c){h._mout(c)}));this.list.find("li").off("click.selectMenu");this.list.on("click","li",function(c){c.stopPropagation();h.select(c,$(this))})};b.prototype._mover=function(e){e.stopPropagation();var f=this;this.obj.addClass("on");this.list.show();this.open=!0;this.setPos(this.list);this._isMobile&&($("body").off("click.selectMenu"),$("body").one("click.selectMenu",function(c){f._mout(c)}))};b.prototype._mout=function(c){this.obj.removeClass("on");this.list.hide();this.open=!1;$("body").off("click.selectMenu")};b.prototype._tap=function(c){this.open?this._mout(c):this._mover(c)};b.prototype.select=function(e,f){this._mout(e);if(!f.attr("selected")&&!f.attr("disabled")&&($("li",this.list).removeAttr("selected"),f.attr("selected","selected"),$(".txt",this.obj).html(f.html()),"undefined"!=typeof this.params.onChange)){this.params.onChange(f)}};b.prototype.createMenu=function(f){$("<span>").addClass("txt").appendTo(f);$("<div>").addClass("b-slt-arrow").appendTo(f);var h=this.params;this.list=$("<ul>").addClass("list").appendTo(f);"undefined"!=typeof h.createList&&h.createList(this.list);if("undefined"!=typeof h.selectorData){for(var g in h.selectorData){this.add(h.selectorData[g].name,h.selectorData[g].attributes)}}return f};b.prototype.add=function(g,k){var j=$("<li>").html(g).appendTo(this.list);if("undefined"!=typeof k){for(var h in k){j.attr(h,k[h])}}return j};b.prototype.setPos=function(c){c.offset().left+c.width()-10>$(".z").width()?c.css({left:"auto",right:"-1px"}):c.css({left:"-1px",right:"auto"})};b.prototype.close=function(c){null!=c&&(c.originalEvent?$(".b-slt").each(function(g,e){var h=$(e);$(".list",h).hide()}):$(".list",c).hide())};b.prototype.getList=function(){return this.obj.find(".list")};return b}();function bindTab(e){var c=e.item||e,c=$(c);c.on("click","li",function(){var a=$(this);if(!a.hasClass("on")&&($(".on",c).removeClass("on"),a.addClass("on"),"undefined"!=typeof e.onChange)){e.onChange(a)}})}var TabModule={bind:bindTab,create:function(k){var j=$('<ul class="b-slt-tab"></ul>');k.wrapper&&j.wrap(k.wrapper);for(var q=k.items||[],p=0;p<q.length;p++){var o=q[p],n=$("<li></li>").text(o.name).appendTo(j);o.selected&&n.addClass("on");if(o.attributes){for(var l in o.attributes){n.attr(l,o.attributes[l])}}}k.wrapper&&(j=j.parent());return j}};function IndexNavigator(b){this.config={sortable:!1,nav:{},block:null};this.mergeConfig(b);this.config.block="undefined"!=typeof indexBlock?indexBlock:null;this.originNav=$.extend(!0,{},this.config.nav);this.nav=$('<div class="index-nav" id="index_nav"><div class="border"></div></div>').appendTo("body").css("opacity",0);this.navItems=[];this.mask=$("<div>").addClass("wnd-mask");this.pointer=$('<div class="pointer-block"></div>').appendTo(this.nav);this.navList=$('<div class="nav-list"></div>').appendTo(this.nav);this.seq=[];this.init()}IndexNavigator.prototype={scrolling:0,customizing:0,apiUrl:"/widget/ajaxIndexSettings",localDataName:"index_user_setting",Cantor:{create:function(){var e,c=[1];for(e=1;12>e;e++){c[e]=c[e-1]*e}return c},encode:function(j){var h,o,n=j.length,l=this.create(),k=[];for(h=0;h<n;h++){for(o=k[h]=0;o<h;o++){j[o]>j[h]&&k[o]++}}for(h=j=0;h<n;h++){j+=k[h]*l[n-h-1]}return j},decode:function(l,j){var s,r,q=[],p=[],o=[],n=this.create();s=l-1;for(r=0;0<=s;s--,r++){q[r]=j/n[s],0!=j&&(j%=n[s]),p[s]=1}for(s=0;s<l;s++){for(r=n=0;r<l;r++){if(n+=p[r],n>q[s]){o[s]=r;p[r]=0;break}}}return o}},init:function(){this.configMap=[];this.nameMap={};for(var e in this.config.nav){this.config.block[e]&&(this.nameMap[e]=this.configMap.length,this.configMap.push(e),this.seq.push(e))}if(this.config.sortable&&null!=ChatGetSettings(this.localDataName)){try{this.userSettings=JSON.parse(ChatGetSettings(this.localDataName)),this.setNavConfig(this.userSettings)}catch(c){}}this.createNavigator()},mergeConfig:function(e){if("object"==typeof e){for(var c in this.config){e.hasOwnProperty(c)&&(this.config[c]=e[c])}}},createNavigator:function(){this.renderNavItem();var e=$('<div class="n-i gotop"><div class="btn_gotop" title="\u8fd4\u56de\u9876\u90e8"></div></div>').appendTo(this.navList);if(0==this.navItems.length){var c=e;e.addClass("sub").append("<div>\u8fd4\u56de\u9876\u90e8</div>")}else{c=this.navItems[0].item,this.pointer.css({top:c.find(".name").position().top,left:c.find(".name").position().left})}this.config.sortable&&this.initCustomize();0<this.navItems.length&&this.config.sortable&&this._show();this.bindScroll();this.bindClick(e,"body")},renderNavItem:function(){this.navItems=[];this.nav.find(".n-i.sortable").remove();var f=null,e;for(e in this.config.nav){if(this.config.block[e]){var g=$('<div class="n-i sortable"><div class="name">'+this.config.nav[e].name+"</div></div>");null==f?g.prependTo(this.navList):g.insertAfter(f);f=g;g.data("data",{key:e,name:this.config.nav[e].name,target:this.config.nav[e].target});this.bindClick(g,this.config.nav[e].target);this.navItems.push({item:g,target:this.config.nav[e].target})}}},setPosition:function(){function g(b){return 0<$(b).length&&h+$(window).scrollTop()<$(b).offset().top+$(b).height()?$(b).offset().top+$(b).height():!1}var f,j=$("body").hasClass("widescreen")?20:5;f=0<$(".main-inner").length?$(".main-inner"):$(".z_header");f=f.offset().left+f.width()+j;var h=$(window).height()-this.nav.height()-50;0>h&&(h=0);g(".header")?h=g(".header"):0==$(".header").length&&g(".z_top")&&(h=g(".z_top"));f+this.nav.width()<=$(window).width()?(f={top:h,left:f,right:"auto"},this.nav.removeClass("side")):(f={top:h,left:"auto",right:0},this.nav.addClass("side"));this.nav.css(f)},setNavConfig:function(j){var h=this,o=h.originNav;if("undefined"!=typeof j.sort){var n={},l=h.Cantor.decode(h.configMap.length,parseInt(j.sort,32));this.sort(l,function(b){b=h.configMap[l[b]];n[b]=o[b]});for(var k in o){n[k]=o[k]}h.config.nav=n}else{h.config.nav=o}},sort:function(f,e){this.seq=[];for(var g in f){this.seq.push(this.configMap[f[g]]),e&&e(g)}},showTip:function(){function j(b){b.stopPropagation();n.fadeOut(200,function(){n.remove();h.nav.removeClass("focus")});o.fadeOut(200,function(){o.remove()})}var h=this,o=h.tipWnd=$("<div>").addClass("nav-tip"),n=h.mask,l=$("<div>").addClass("close").appendTo(o),k=$("<div>").addClass("ok").appendTo(o);n.appendTo("body").fadeIn();o.appendTo("body").fadeIn();h.nav.addClass("focus");l.on("click",j);k.on("click",j)},loadSetting:function(f){var e=this,g=setInterval(function(){"undefined"!=typeof window.biliLoginStatus&&(clearInterval(g),window.biliLoginStatus.isLogin&&("undefined"==typeof e.userSettings||e.userSettings.expires&&e.userSettings.expires<(new Date).getTime())&&$.ajax({url:e.apiUrl,type:"post",dataType:"json",success:function(b){try{var h=JSON.parse(b.settings);!1===h&&(h={sort:0},e.uploadSetting(h),e.showTip());e.saveSetting(h);e.setNavConfig(h);ModuleManage.sort(f||ModuleManage.pageModules[0],e.seq);ModuleManage.lazy()}catch(a){h={},e.saveSetting(h)}e.renderNavItem();e.follow()}}))},300)},uploadSetting:function(b){window.biliLoginStatus&&window.biliLoginStatus.isLogin&&$.post(this.apiUrl,{act:"set",settings:JSON.stringify(b)})},saveSetting:function(b){b.expires=(new Date).getTime()+600000;ChatSaveSettings(this.localDataName,JSON.stringify(b));this.userSettings=$.extend(!0,{},b)},bindClick:function(f,e){var g=this;f.click(function(){g.scrolling=1;$("html,body").animate({scrollTop:$(e).offset().top},200,function(){g.scrolling=0})})},bindScroll:function(){var b=this;$(window).resize(function(){b.setPosition()});$(window).scroll(function(){300<$(this).scrollTop()||b.config.sortable?b._show():b._hide();b.customizing||b.follow()})},_show:function(){this.nav.show();this.setPosition();this.nav.stop().animate({opacity:1},200)},_hide:function(){var b=this;b.nav.stop().animate({opacity:0},200,function(){b.nav.hide()})},follow:function(){for(var h=$(window),g=-1,l=0;l<this.navItems.length;l++){var k=this.navItems[l].item,j=$(this.navItems[l].target);if(j.length&&h.scrollTop()+h.height()/2>j.offset().top&&h.scrollTop()+h.height()/3<j.offset().top+j.height()){this.nav.find(".n-i").removeClass("on");this.pointer.show().css({top:k.find(".name").position().top,left:k.find(".name").position().left});k.addClass("on");g=k.index();break}}-1==g&&(this.nav.find(".n-i").removeClass("on"),this.pointer.fadeOut(100))},initCustomize:function(){function j(){h.nav.removeClass("customizing");n.stop().fadeOut(300,function(){l.remove();o.remove();n.remove()});h.nav.sortable("disable");h.follow();h.customizing=0;$("body").off("click",j);"undefined"==typeof k.sort||"undefined"!=typeof h.userSettings.sort&&k.sort==h.userSettings.sort||(h.uploadSetting(k),h.saveSetting(k))}var h=this;h.customContainer=$('<div class="n-i customize" title="\u81ea\u5b9a\u4e49"></div>').appendTo(h.navList);var o=$('<div class="tip"></div>'),n=h.mask,l=$('<div class="custom-bg"></div>'),k=$.extend(!0,{},h.userSettings);delete k.expires;h.nav.on("click",function(b){b.stopPropagation()});h.customContainer.click(function(a){a.stopPropagation();h.customizing?j():(h.pointer.hide(),n.is(":visible")||n.appendTo("body").stop().hide().fadeIn(),"undefined"!=typeof h.tipWnd&&h.tipWnd.fadeOut(200,function(){h.tipWnd.remove()}),l.prependTo(h.nav).show(),o.prependTo(h.nav).show(),h.nav.removeClass("focus").addClass("customizing"),h.nav.find(".on").removeClass("on"),h.customModuleInitialized?h.nav.sortable("enable"):(h.nav.sortable({items:".sortable",cancel:".gotop,.customize",update:function(b,p){var q=$(p.item.data("data").target);p.item.prev().hasClass("n-i")?q.insertAfter(p.item.prev().data("data").target):q.insertBefore(p.item.next().data("data").target);ModuleManage.lazy();null==k&&(k={sort:0});var g=[];h.nav.find(".sortable").each(function(f,r){var s=$(r).data("data");g.push(h.nameMap[s.key])});h.sort(g);k.sort=h.Cantor.encode(g).toString(32)}}),h.customModuleInitialized=!0),h.customizing=1,$("body").on("click",j))})}};window.Captcha={value:null,_tryTime:0,_maxTryTime:5,_query:[],_xhr:null,async:!1,set:function(e,c){this._query.push([e,c]);1<this._query.length||this._load()},_load:function(){var e=this;this._tryTime++;if(this._tryTime>e._maxTryTime){for(var c=this._tryTime=0;c<e._query.length;c++){if(e._query[c]&&e._query[c][1]){e._query[c][1]()}}e._query=[]}else{this._xhr=$.ajax({url:"http://www.bilibili.com/plus/widget/ajaxGetCaptchaKey.php",dataType:"json",async:this.async,success:function(a){window.captcha_key=e.value=a;for(var f=e._tryTime=0;f<e._query.length;f++){if(e._query[f]&&e._query[f][0]){e._query[f][0](a)}}e._query=[]},error:function(){setTimeout(function(){e._load()},500)}})}}};var SliderController=function(b){this.params=b;this._mouseIn=!1};SliderController.prototype={pointer:0,length:0,timer:null,init:function(){var e=this,c=e.params;0<$(c.parent).find(".p-loading").length?e.loading=$(c.parent).find(".p-loading"):e.loading=$('<div class="p-loading"></div>');e.wrapper=$(c.wrapper).appendTo($(c.parent));e.container=$(c.container).prependTo(e.wrapper);e.bar=$(c.bar);c.barContainer?e.bar.appendTo(e.wrapper.find(c.barContainer)):e.bar.appendTo(e.wrapper);c.dataSrc&&(0==$(c.parent).find(".p-loading").length&&e.loading.appendTo(e.wrapper),$.getJSON(c.dataSrc,function(a){e.loading.remove();e.load(a)}))},load:function(g){var f=this.params,j;if(j=f.onLoad?f.onLoad(g):g.list){for(var h in j){"object"==typeof j[h]&&(f.onData&&!1!==f.onData(j[h])||!f.onData)&&this.add(j[h])}}0==this.length&&($('<li class="no-data">\u6ca1\u6709\u6570\u636e</li>').appendTo(this.container),this.bar.hide());$("[bar]:eq(0)",this.bar).addClass("on");this.setTimer();f.initCallback&&f.initCallback(this.wrapper,g)},add:function(k,j){var q=this.params,p=100*this.length,o=$(q.barItem);o.appendTo(this.bar).attr("bar","bar");var n=this.length;0==this.length&&o.addClass("on");q.barRenderCallback&&q.barRenderCallback(o,k,n);var l;"function"==typeof q.item?l=q.item(k,n):(l=$(q.item),$("img",l).attr("src",k.img),$("a",l).attr("href",k.link));l.attr("preview","preview");l.appendTo(this.container);q.renderCallback&&q.renderCallback(this.wrapper,k,n,l);this.bindBarEvent(o);this.bindPreviewEvent(l);this.length++;this.container.width(p+100+"%");"undefined"!=typeof j&&j(this.wrapper,k)},bindBarEvent:function(e){var c=this;void 0!==browser&&(browser.version.mobile||browser.version.ios||browser.version.android||browser.version.windowsphone)||e.hover(function(){c._mouseIn=!0;clearInterval(c.timer)},function(){c._mouseIn=!1;c.setTimer()});e.click(function(){var b=$(this);b.hasClass("on")||(c.bar.find("[bar]").removeClass("on"),b.addClass("on"),b=b.index(),c.slide(b))})},slide:function(e){var c=this.params;this.pointer=e;this._mouseIn||this.setTimer();this.container.animate({"margin-left":100*-e+"%"},200);c.slideCallback&&c.slideCallback(this.wrapper,e)},bindPreviewEvent:function(e){var c=this;e.hover(function(){clearInterval(c.timer)},function(){c.setTimer()})},setTimer:function(){var e=this,c=e.params;clearInterval(this.timer);0!=c.timeout&&1!=e.length&&(e.timer=setInterval(function(){e.next();$("[bar]",e.bar).removeClass("on");$("[bar]:eq("+e.pointer+")",e.bar).addClass("on")},c.timeout||5000))},next:function(){this.pointer=this.pointer<this.length-1?this.pointer+1:0;this.slide(this.pointer)},prev:function(){this.pointer=0<this.pointer?this.pointer-1:this.length-1;this.slide(this.pointer)},destroy:function(){clearInterval(this.timer);this.wrapper.remove()}};(function(f){function e(a){this.options={appendTo:"body",target:null,container:'<ul class="bilibili-suggest"></ul>',css:null,position:null,positionOffset:{top:0,left:0},minLength:1,delay:300,disabled:!1,menuItem:"menuItem",useBuffer:!0,source:null,defaultSource:null,renderMenu:this.renderMenu,renderItem:this.renderItem,create:function(){},select:function(){},change:function(){},search:function(){},open:function(){},close:function(){},focus:function(){}};this.merge(a);this.options._super=this;this.namespace="bilibiliSuggest";this.$container=f(this.options.container);this.$target=f(this.options.target);this.elements=this._getMenuItem();this.source={};this.value=this._value();this.selectedItem=null;this.tempValue=this.value;this.delayTimer=null;this.dataBuffer={};this.loading=this.enterLock=0}var g=0;e.prototype={escapeRegex:function(b){return b.replace(/[\-\[\]{}()*+?.,\\\^$|#\s]/g,"\\$&")},filter:function(a,j){var h=RegExp(this.escapeRegex(j),"i");return f.grep(a,function(b){return h.test(b.label||b.value||b)})},init:function(){var h=this;this._create();this._initSource("source");this._initSource("defaultSource");var c=this.namespace;this.$target.data(c,this.prototype);this.options.target.off("."+c);this.options.target.on("keydown."+c,function(a){switch(a.keyCode){case 38:h._move(a,"up");break;case 40:h._move(a,"down");break;case 9:h._isActive()&&h._select(a);break;case 13:h._isActive()&&(a.preventDefault(),h._select(a));break;case 27:h.$container.is(":visible")&&(h._value(h.value),h._close(a),a.preventDefault())}}).on("input."+c,function(a){h._change(a)}).on("focusout."+c,function(a){h.cancelBlur?delete h.cancelBlur:(clearTimeout(h.delayTimer),h._close(a))}).on("focus."+c,function(a){h._change(a)});return this},_change:function(b){this.options.disabled||(this.value=this._value(),this.tempValue==this.value&&"focus"!=b.type)||(this.tempValue=this.value,b.stopPropagation(),this.search(b),this._trigger("change",b,{item:this.selectedItem}))},_move:function(l,j){if(this.$container.is(":visible")){this.enterLock=0;var p,o;this.selectedItem=null;"up"==j?(p="last",o=-1):(p="first",o=1);if(0==this._getMenuItemFocused().length){this.selectedItem=this.elements[p]().addClass("focus")}else{p=this._getMenuItemFocused().index("[role="+this.options.menuItem+"]");this.elements.removeClass("focus");var n=p+o;0<=n&&n<this.elements.length&&(this.selectedItem=this.elements.filter(":eq("+(p+o)+")").addClass("focus"))}null!=this.selectedItem?(this.selectedItem.position().top+this.selectedItem.outerHeight()>=this.$container.height()?this.$container.scrollTop(this.$container.scrollTop()+(this.selectedItem.position().top+this.selectedItem.outerHeight()-this.$container.height())):0>this.selectedItem.position().top&&this.$container.scrollTop(this.$container.scrollTop()+this.selectedItem.position().top),this._focus(l)):this._value(this.value);l.preventDefault()}},_isActive:function(){return this.$container.is(":visible")&&this.selectedItem},_getMenuItem:function(){return this.$container.find("[role="+this.options.menuItem+"]")},_getMenuItemFocused:function(){return this._getMenuItem().filter(".focus")},merge:function(h){if("object"==typeof h){for(var c in this.options){h.hasOwnProperty(c)&&(this.options[c]=h[c])}}},_trigger:function(){var h=Array.prototype.slice.call(arguments,0),c=h.shift();if(this.options[c]){return this.options[c].apply(this,h)}},_create:function(){this._setPos();this.$container.appendTo(this.options.appendTo).hide();"object"==typeof this.options.css&&this.$container.css(this.options.css);this._trigger("create")},enable:function(){this.options.disabled=!1},disable:function(){clearTimeout(this.delayTimer);this.options.disabled=!0},destroy:function(){clearTimeout(this.delayTimer);this.$target.removeData(this.namespace);this.$target.off("."+this.namespace);this.$container.remove()},_setPos:function(){var b=this.options.position||{};this.options.position||(b.top=this.$target.offset().top+this.$target.outerHeight(),b.left=this.$target.offset().left);this.$container.css({top:b.top+this.options.positionOffset.top,left:b.left+this.options.positionOffset.left})},_open:function(b){this._setPos();this.$container.show();this._trigger("open",this.$container,b)},_close:function(b){this.$container.hide();this._trigger("close",this.$container,b)},_initSource:function(a){var l,k,j=this;f.isArray(this.options[a])?(l=this.options[a],this.source[a]=function(h,c){c(j.filter(l,h.term))}):"string"===typeof this.options[a]?(k=this.options[a],this.source[a]=function(h,n){j.xhr&&j.xhr.abort();j.xhr=f.ajax({url:k,data:h,dataType:"json",success:function(b){n(b)},error:function(){n([])}})}):this.source[a]=this.options[a]},search:function(h){var c=this;clearTimeout(this.delayTimer);this.delayTimer=setTimeout(function(){c.selectedItem=null;c._search(null,h)},this.options.delay)},_search:function(a,j){a=null!=a?a:this._value();this.value=this._value();var h="source";if(!this._value()){h="defaultSource"}else{if(this._value().length<this.options.minLength){this._close(j);return}}!1===this._trigger("search",j)?this._close(j):this.options.useBuffer&&"undefined"!=typeof this.dataBuffer[a]&&!f.isArray(this.source[h])?this._response(this.dataBuffer[a]):this.source[h]&&(this.loading++,this.$container.addClass("loading"),this.source[h]({term:a},this.response(a)))},response:function(h){var c=this,j=++g;return function(){h&&(c.dataBuffer[h]=arguments[0]);j===g&&c._response.apply(c,arguments);c.loading--;c.loading||c.$container.removeClass("loading")}},_response:function(b){b=this._normalize(b);this.render(b)},render:function(a){this.$container.empty();var h=this;this.options.disabled||!a||!a.length||this.cancelSearch?this._close():(this._open(),this._renderMenu(this.$container,a),f("<iframe></iframe>").css({position:"absolute",left:"0px",top:"0px",width:"100%",height:"100%",border:"none",zIndex:-1}).attr({border:0,frameborder:"no"}).appendTo(this.$container),this.elements=this._getMenuItem(),this.elements.on("mousedown",function(b){b.preventDefault();h.cancelBlur=!0;h._delay(function(){delete h.cancelBlur})}).on("click",function(b){h._select(b)}).on("mouseenter",function(c){var j=f(this);h.enterLock=1;h._getMenuItem().removeClass("focus");j.addClass("focus");h.selectedItem=j;h._focus(c)}).on("mouseleave",function(c){c=f(this);h.enterLock=0;c.removeClass("focus");h.selectedItem=null}))},_renderMenu:function(h,c){this._trigger("renderMenu",h,c)},renderMenu:function(a,j){var h=this;f.each(j,function(b,k){h._renderItem(a,k)})},_renderItem:function(h,c){this._trigger("renderItem",h,c).attr("role",this.options.menuItem).data("item",c)},renderItem:function(a,h){return f("<li>").addClass("suggest-item").attr({"data-value":h.value}).append(f("<div>").text(h.value)).appendTo(a)},_normalize:function(a){return a.length&&a[0].label&&a[0].value?a:f.map(a,function(c){return"string"===typeof c?{label:c,value:c}:f.extend({label:c.label||c.value,value:c.value||c.label},c)})},_select:function(h){var c=this.selectedItem.data("item");if(!this.enterLock||h.originalEvent&&!/^key/.test(h.originalEvent.type)){this.value=this.tempValue=this._value(c.value)}this._trigger("select",h,{item:c});this._close()},_focus:function(h){var c=this.selectedItem.data("item");!0===this._trigger("focus",h,{item:c})&&(h.originalEvent&&/^key/.test(h.originalEvent.type))&&this._value(c.value)},_value:function(b){b&&this.$target.val(b);return this.$target.val()},_delay:function(b){setTimeout(b,0)}};f.fn.bilibiliSuggestion=function(b){b.target=this;return(new e(b)).init()}})(jQuery);function bindLoginWnd(g){g=$(g);var f=$('<div class="login-wnd"><div class="wnd-close"></div><div class="login-wnd-content"><iframe frameborder="0" scrolling="no" src="http://www.bilibili.com/html/login_wnd.html"></iframe></div></div>');(function(){function b(a){window.open(a.url,"","width=700, height=400, top=0, left=0, toolbar=no, menubar=no, scrollbars=no, location=yes, status=no")}function q(){if($("#user",f).val()){if(!$("#password",f).val()){return o.prependTo(".login-item.password",f).text("\u8bf7\u8f93\u5165\u5bc6\u7801"),!1}if(!$("#checkcode",f).val()){return o.prependTo(".login-item.checkcode",f).text("\u8bf7\u8f93\u5165\u9a8c\u8bc1\u7801"),!1}}else{return o.prependTo(".login-item.user",f).text("\u8bf7\u8f93\u5165\u8d26\u53f7\u6216\u90ae\u7bb1"),!1}o.remove();return !0}window.loginCallback=function(c){console.log(c)};$("#checkcode",f).one("focus",function(){$("#_yzm",f).html("<img src='https://secure.bilibili.com/captcha?r="+Math.random()+'\' style="cursor:pointer" />')});$("#_yzm",f).click(function(){$("#_yzm",f).html("<img src='https://secure.bilibili.com/captcha?r="+Math.random()+'\' style="cursor:pointer" />')});$("#weibopart a",f).click(function(){b(p)});$("#qqpart a",f).click(function(){b(l)});var o=$('<div class="error-msg"></div>'),l={url:"https://secure.bilibili.com/login?sns=qq"},p={url:"https://secure.bilibili.com/login?sns=weibo"};$("#user,#password,#checkcode",f).keyup(function(){o.remove()});$("#login_submit",f).click(function(){q()&&$("#userlogin",f).submit()})})();var j=$('<div class="login-wnd-mask"></div>'),h=f.find(".wnd-close");g.click(function(){j.appendTo("body").hide().fadeIn(100);f.appendTo("body").hide().fadeIn(100);f.css({top:$(window).scrollTop()+$(window).height()/2});h.click(function(){j.fadeOut(100);f.fadeOut(100,function(){j.remove();f.remove()})})});return !1}function FakeDanmu(e){this.messages=[];this.elems=[];this.config={delay:1,rows:2,lifeTime:5,width:300,height:200,parent:null,messages:null,aid:null,cssProfix:"fake_danmu_gen",textStyle:'color: #fff;font-size: 12px;font-family: "Microsoft Yahei", simhei, "\u9ed1\u4f53";display: inline;position: absolute;white-space: pre;pointer-events: none;opacity: 0.95;text-shadow: 1px 1px 2px #001;visibility: hidden'.split(";")};this.setConfig(e);this.duration=this.config.lifeTime;this.delayTimer=this.loopTimer=0;this.loadState=FakeDanmu.READY;this.paused=!0;this.id=FakeDanmu._id++;null==FakeDanmu.styleElement&&(FakeDanmu.styleElement=document.createElement("style"),(document.head||document.getElementsByTagName("head")[0]).appendChild(FakeDanmu.styleElement));try{FakeDanmu.styleElement.innerHTML="."+this.config.cssProfix+"_shared{\r\n"+this.config.textStyle.join(";\r\n")+";\r\n}\r\n"}catch(c){FakeDanmu.enabled=!1,this.loadState=FakeDanmu.COMPLETE}}FakeDanmu._id=0;FakeDanmu.enabled=!0;FakeDanmu.READY=0;FakeDanmu.LOADING=1;FakeDanmu.COMPLETE=2;FakeDanmu.prototype={constructor:FakeDanmu,init:function(b){this.messages=b;this.render()},setConfig:function(e){if("object"==typeof e){for(var c in this.config){e.hasOwnProperty(c)&&(this.config[c]=e[c])}}},render:function(){this.elems=[];this.duration=this.config.lifeTime;var e;for(e=0;e<this.messages.length;e++){var c=this.renderText(this.messages[e]);this.insertText(c)}this.restoreStyle()},restoreStyle:function(){var f=[],e;f.push("."+this.config.cssProfix+"_shared{\r\n"+this.config.textStyle.join(";\r\n")+";\r\n}\r\n");for(e=0;e<this.elems.length;e++){var g=this.elems[e];f.push("."+g.cssClass+"{\r\n"+g.cssText+"\r\n}\r\n")}FakeDanmu.styleElement.innerHTML=f.join("")},renderText:function(e){var c=document.createElement("div");c.appendChild(document.createTextNode(e));c.className=this.config.cssProfix+"_shared";this.config.parent.appendChild(c);return{elem:c,width:c.offsetWidth,height:c.offsetHeight}},insertText:function(k){var j=this.elems.length,q=j*this.config.lifeTime/this.config.rows/this.config.rows,p=k.height*(j%this.config.rows),o=this.config.lifeTime,n=k.elem;this.duration=q+o;var l=[];l.push("visibility: visible");l.push("top: "+p+"px");l.push("left: "+this.config.width+"px");l.push("transform: translateX(-"+(this.config.width+k.width)+"px)");l.push("transition: transform "+o+"s linear "+q+"s");this.elems.push({elem:n,cssClass:this.config.cssProfix+"_"+j,cssText:l.join(";\r\n")+";"})},pause:function(){this.paused=!0;if(0<this.config.delay&&0!=this.delayTimer){clearTimeout(this.delayTimer),this.delayTimer=0}else{if(this.loadState==FakeDanmu.COMPLETE){var b;for(b=0;b<this.elems.length;b++){this.elems[b].elem.className=this.config.cssProfix+"_shared"}this.loopTimer&&clearTimeout(this.loopTimer);this.loopTimer=0}}},play:function(){var b=this;this.paused=!1;0<this.config.delay?(0!=this.delayTimer&&clearTimeout(this.delayTimer),this.delayTimer=setTimeout(function(){b.delayHandler()},1000*this.config.delay)):this._play()},_play:function(){if(this.loadState!=FakeDanmu.COMPLETE){this.delayHandler()}else{var f=this,e;for(e=0;e<this.elems.length;e++){var g=this.elems[e];g.elem.className=this.config.cssProfix+"_shared "+g.cssClass}this.loopTimer&&clearTimeout(this.loopTimer);this.loopTimer=setTimeout(function(){f.restartHandler()},1000*this.duration)}},restartHandler:function(){this.loopTimer=0;this.pause();var b=this;this.loopTimer=setTimeout(function(){b._play()},100)},load:function(e){if(this.loadState==FakeDanmu.READY){this.loadState=FakeDanmu.LOADING;var c=this;$.getJSON("/widget/ajaxGetComment?aid="+e,function(b){c.loadState=b?FakeDanmu.COMPLETE:FakeDanmu.READY;b&&(c.init(b),c.paused||c._play())})}},delayHandler:function(){clearTimeout(this.delayTimer);this.delayTimer=0;this.loadState==FakeDanmu.COMPLETE?this._play():this.loadState==FakeDanmu.READY&&(this.config.aid?this.load(this.config.aid):this.config.messages&&(this.loadState=FakeDanmu.COMPLETE,this.init(this.config.messages),this._play()))}};FakeDanmu.play=function(e){if(FakeDanmu.enabled){var c=e.parent;c.fakeDanmu?c.fakeDanmu.restoreStyle():c.fakeDanmu=new FakeDanmu(e);c.fakeDanmu.play();return c.fakeDanmu}};FakeDanmu.pause=function(e){if(FakeDanmu.enabled){var c=e.parent;c.fakeDanmu||(c.fakeDanmu=new FakeDanmu(e));c.fakeDanmu.pause();return c.fakeDanmu}};Date.prototype.format=function(f){var e={"M+":this.getMonth()+1,"d+|D+":this.getDate(),"h+|H+":this.getHours(),"m+":this.getMinutes(),"s+":this.getSeconds(),"q+":Math.floor((this.getMonth()+3)/3),S:this.getMilliseconds()};/(y+|Y+)/.test(f)&&(f=f.replace(RegExp.$1,(this.getFullYear()+"").substr(4-RegExp.$1.length)));for(var g in e){RegExp("("+g+")").test(f)&&(f=f.replace(RegExp.$1,1==RegExp.$1.length?e[g]:("00"+e[g]).substr((""+e[g]).length)))}return f};$(function(){$("body").on("mouseover",".v .preview",function(){FakeDanmu.play({width:180,height:110,parent:this,aid:$(this).closest(".v").find("a").attr("href").match(/av(\d+)/)[1]})}).on("mouseout",".v .preview",function(){FakeDanmu.pause({width:180,height:110,parent:this,aid:$(this).closest(".v").find("a").attr("href").match(/av(\d+)/)[1]})});0==$("#index_container").length&&0<$(".z_top .board").length&&new IndexNavigator;$("#search-keyword").focus(function(){$(this).closest(".search").addClass("focus")});$("#search-keyword").focusout(function(){$(this).closest(".search").removeClass("focus")});var b=setInterval(function(){"undefined"!=typeof play_online&&(clearInterval(b),""==$(".index_online .web-online").html()&&($("#index_online .web-online,.index_online .web-online").html("\u5728\u7ebf:"+web_online),$("#index_online .online,.index_online .online").html("\u6b63\u5728\u89c2\u770b:"+play_online)))},300);$("li[i_menu],.z_top .z_top_nav li.home").each(function(h,n){n=$(n);var l=n.attr("i_menu"),k=n.attr("i_menu")?$(n.attr("i_menu")):n.find(".mini-wnd"),j=null;n.hover(function(){clearTimeout(j);(!k.is(":visible")||1>parseInt(k.css("opacity")))&&"#dyn_wnd"!=l&&(j=setTimeout(function(){k.fadeIn("fast")},300))},function(){clearTimeout(j);j=setTimeout(function(){k.fadeOut("fast")},300)})});if("undefined"!=typeof countInfo){for(i in type_offset){"undefined"!=typeof countInfo["c"+i]&&countInfo["c"+i]&&0!=countInfo["c"+i]&&($(".addnew_"+i).html(countInfo["c"+i]),$(".addnew_"+i).fadeIn(500))}}0<$(".search-keyword").length&&(onLoginInfoLoaded(function(c){"old"==ChatGetSettings("search_preference")&&$("#searchform").attr("action","http://www.bilibili.com/search_v1")}),$("#search-keyword").bilibiliSuggestion({css:{minWidth:200},positionOffset:{top:4,left:-14},source:function(e,f){e.term.split(" ");$.getJSON("/suggest?jsoncallback=?",{term:e.term,rnd:Math.random()},f)},search:function(){var e=this.value,f=e.split(" ");if(1>f[f.length-1].length||255>e.charCodeAt(0)&&1>e.length||40<e.length){return !1}},focus:function(e,f){return !1},select:function(e,f){$("#searchform").submit();return !1},renderItem:function(e,f){return $("<li>").addClass("suggest-item").data("item.autocomplete",f).append('<a style="text-align:left">'+f.value+'<em style="float:right;font-size:10px;"'+(f.match?' title="(Match Token: '+f.match+')"':"")+">"+(f.desc?f.desc:f.ref+"\u4e2a")+"</em></a>").appendTo(e)}}));$.support.opacity||($('input[placeholder!=""][type=text]').blur(function(){var c=$(this).attr("placeholder");c&&""===this.value&&(this.value=c,this.style.color="graytext")}),$('input[placeholder!=""][type=text]').focus(function(){var c=$(this).attr("placeholder");c&&(this.value===c&&(this.value=""),this.style.color="")}),$('input[placeholder!=""][type=text]').val(function(f,h){var g=$(this).attr("placeholder");return g?""===h?(this.style.color="graytext",g):h:this.value}));bindCardEvent();bindPOCoins2($(".v"));formatInterval=setTimeout(function(){$(".v .i .i1, .v .i .i2, #dianji, .w_info .gk, .w_info .sc, .w_info .dm, .rlist .i .c1, .rlist .i .c2").html(function(){return formatFriendlyNumber($(this).html())})},500)});function formatFriendlyNumber(f){if(!(0<=f.indexOf("\u4e07"))){if(0<=f.indexOf(",")){f=f.split(",");for(var e="",g=0;g<f.length;g++){e+=f[g]}f=e}(f=parseInt(f))?10000<=f&&(f=(f/10000).toFixed(1)+"\u4e07"):f="--";return f}};